<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/logo.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=5.1.4"><link rel="mask-icon" href="/logo.png?v=5.1.4" color="#222"><meta name="keywords" content="Google SEO, 互联网营销, 工业品营销, 矿山机械"><link rel="alternate" href="/atom.xml" title="Ray's Blog" type="application/atom+xml"><meta name="description" content="Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销"><meta property="og:type" content="website"><meta property="og:title" content="Ray&#39;s Blog"><meta property="og:url" content="http://love4026.org/page/9/index.html"><meta property="og:site_name" content="Ray&#39;s Blog"><meta property="og:description" content="Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销"><meta property="og:locale" content="zh-Hans"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Ray&#39;s Blog"><meta name="twitter:description" content="Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://love4026.org/page/9/"><title>Google SEO|互联网营销|工业品营销|矿山机械电子商务|B2B、SEM、社交、EDM邮件营销、市场营销 - Ray's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Ray's Blog</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Google SEO|互联网营销|工业矿山机械</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-友情链接"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br> 友情链接</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313828/大学仍是跻身中产阶级的门票/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313828/大学仍是跻身中产阶级的门票/" itemprop="url">大学仍是跻身中产阶级的门票</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-07T02:25:53+08:00">2014-06-07</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/转载/" itemprop="url" rel="index"><span itemprop="name">转载</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1,904</span></span></div></header><div class="post-body" itemprop="articleBody"><p>一些刚刚走出校门的大学毕业生很难找到工作。其他人则接受了他们觉得大材小用的工作。与此同时，学生债务已经突破1万亿美元大关。</p><p>这足以引发一波关于大学教育是否仍然值得的问题。</p><p>一组新的收入统计数据非常清楚地回答了这些问题：是的，大学值得上，而且差别还不是一丁点。尽管许多年轻的大学毕业生面临种种困境，但一个四年制学位或许从来没有比现在更有价值。</p><p>华盛顿经济政策研究所(Economic Policy Institute)根据劳工部统计数据所做的最新分析显示，大学毕业生和其他人的薪酬差距在去年达到历史最高。2013年，有四年制大学学位的美国人的平均时薪比没有学位的美国人足足高了98%。五年前、10年前和上世纪80年代初的薪酬差距分别是89%、85%和64%。</p><p>这种趋势并没有任何必然性。如果大学毕业生的人数超过经济需要，薪酬差距就会缩小。这种差距的最近一次增长尤为显著，因为它是在大学毕业生数量增长（其部分原因是，许多人在“大衰退”期间重返学校深造）之后出现的。薪酬差距仍然继续增长这一事实意味着，美国培养的大学生依然不够用。</p><p>“目前的大学毕业生太少了，”麻省理工学院(MIT)经济学家大卫·奥特尔(David Autor)说。“准备上大学的人也太少了。”奥特尔并未参与经济政策研究所的分析。</p><p>强调这些不足是非常重要的，因为如今的公开讨论（新闻媒体对此担有一定责任）通常聚焦于一个无可否认的事实：一个学士学位并不能确保成功。当然不能。没有什么东西能确保成功，特别是经过15年令人失望的经济增长和日益严重的不平等之后。</p><p>几乎可以肯定是，当专家和记者花费这么多时间谈论教育的局限性时，他们其实是在劝阻一些青少年不要上大学，成年人不要重返学校攻读学位。（与此同时，这些专家和记者正在送自己的子女上大学，而且经常为应该上哪所大学而困扰。）由于担心不划算而决定不上大学，是一个人在2014年有可能做出的最缺乏经济理性的决策之一。</p><p>受到热烈讨论的上大学成本也无法改变这个事实。根据奥特尔上周四发表于《科学》杂志(Science)的一篇论文，大学学位的真实成本大约是负50万美元。这是正确的：从长远来看，大学教育比免费还便宜。不上大学将使你损失大约50万美元。</p><p>奥特尔这篇论文以经济学家克里斯托弗·艾利(Christopher Avery)和莎拉·特纳(Sarah Turner)的研究成果为基础。它首先通过计算大学学杂费的真实成本得出一个数字，随后用大学毕业生和高中毕业生的终生收入差距减去这个金额。剔除通货膨胀和货币时间价值因素后，上大学的净成本为负50万美元，几乎是30年前的两倍。</p><p>这样计算肯定是不太精确的，因为它没有控制大学毕业生和非大学毕业生预先存在的差异，即无论上不上大学都会存在的差异。然而，还有一些研究在比较了其他方面类似的大学毕业生和非大学毕业生之后，也发现大学教育能够带来丰厚回报。</p><p>与此类似，经济政策研究所的新数据还显示，上大学的好处不仅仅属于通常会继续攻读研究生学位的名牌大学毕业生。只拥有学士学位的人和无学位人群的工资差距也在不断上升。</p><p>但引人注目的是，上过大学但未获得学士学位的人（这一群体还包括社区大学毕业生）的工资溢价并没有上涨。高经济回报属于那些有四年制大学学位的人。这些回报突显了减少大学辍学率的重要性——在《纽约时报杂志》(Times Magazine)最近一篇文章中，保罗·塔夫(Paul Tough)描述了得克萨斯大学(University of Texas)为减少辍学率所做的努力。</p><p>但你肯定听说有不少大学生负债累累，而且还找不到工作，这些令人震惊的故事又该如何解释呢？</p><p>这些轶事可能是真的，但传统思维往往夸大了这个问题。办理贷款的四年制大学毕业生人均负债约2.5万美元，与上大学的经济收益相比，这笔钱显得微乎其微。（扣除通胀因素后，我自己的学生债务几乎等同于这个数字。）拥有学士学位的25至34岁年轻人在4月份的失业率仅仅3%而已。</p><p>我发现经济政策研究所的数据特别耐人寻味。原因是，这家左翼研究机构特意强调，教育并非所有经济问题的解决方案。这也是很重要的。如同几乎所有其他人一样，大学毕业生也正在遭受经济增长乏力，增长收益不成比例地流向最富裕家庭等现象的负面影响。</p><p>过去10年，大学毕业生的平均时薪仅上涨了1%，到大约32.60美元。薪酬差距增大的主要原因是，其他人的平均工资下降了——下降5%，降至大约16.50美元。“在我看来，整体现状是，几乎所有人的工资都没有增长，无论他或她从事何种工作，”该研究所所长劳伦斯·米舍尔(Lawrence Mishel)对我说。“工资的增长趋势在2002年就基本停止了。”</p><p>从整个国家的角度来看，教育只能解决美国经济的部分问题。我们还需要找到其他方式来提升生活水平——更不用说我们需要设法为没有大学学位的人提供好工作。</p><p>但从几乎任何个体的角度来看，上大学是一个无需动脑就可以做出的决定。这是迈入中产阶级乃至更富裕阶层的最可靠的入场券。质疑大学教育价值的人往往是那些明知道自己的孩子将来会上大学的人。</p><p>就在几十年前，高中还被视为教育的前沿。有些人甚至认为，鼓励出身卑微的美国人花费四年光阴上高中是一种浪费。到了今天，每个人都应该接受13年学校教育这种观点显然是不容置疑的。</p><p>但大约13年的教育没有什么神奇之处。随着经济在技术层面变得更加复杂，人们需要接受教育的时间将会上升。在某个时点，15年或17年教育将成为一个更有意义的普遍目标。</p><p>这个时点，其实已经到来。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313824/firefox扩展的自动更新功能/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313824/firefox扩展的自动更新功能/" itemprop="url">firefox扩展的自动更新功能</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-07T02:01:36+08:00">2014-06-07</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端设计/" itemprop="url" rel="index"><span itemprop="name">前端设计</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">163</span></span></div></header><div class="post-body" itemprop="articleBody"><p>在本地开发的插件如果没有上传到firefox的在线扩展里面，你需要设置一个自动更新，如果有更新，安装你插件的用户便可以自动更新。<br><a href="http://www.borngeek.com/firefox/automatic-firefox-extension-updates/" target="_blank" rel="noopener">http://www.borngeek.com/firefox/automatic-firefox-extension-updates/</a> 这篇文章，详细介绍了如何设置自动更新。</p><p><strong>关于调试：</strong></p><p>在about:config里，将extensions.logging值设为true，并关闭firefox<br>在命令行下运行firefox -console，这样启动时，控制台会有extension的log输出。<br>从命令行界面可以看到一些提示信息，根据这些信息，你可以更好的知道自己的插件为什么不能更新。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313821/javascript-获取网址的顶级域名/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313821/javascript-获取网址的顶级域名/" itemprop="url">javascript 获取网址的顶级域名</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-04T03:23:21+08:00">2014-06-04</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端设计/" itemprop="url" rel="index"><span itemprop="name">前端设计</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">134</span></span></div></header><div class="post-body" itemprop="articleBody"><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function getHostname(url)&#123;</span><br><span class="line">	var a = document.createElement(<span class="string">'a'</span>);</span><br><span class="line">	a.href = url;</span><br><span class="line">	<span class="keyword">return</span> a.hostname;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function GetTopDomain(host)&#123;</span><br><span class="line">  <span class="keyword">if</span>(host.indexOf(<span class="string">"http"</span>) &amp;<span class="keyword">gt</span>; -<span class="number">1</span>)</span><br><span class="line">  	host = getHostname(host);</span><br><span class="line">  var <span class="keyword">index</span> = host.lastIndexOf(<span class="string">'.'</span>), <span class="keyword">last</span> = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">index</span> &amp;<span class="keyword">gt</span>; <span class="number">0</span> &amp;amp;&amp;amp; <span class="keyword">index</span> &amp;<span class="keyword">gt</span>;= <span class="keyword">last</span> - <span class="number">4</span>)&#123;</span><br><span class="line">    <span class="keyword">last</span> = <span class="keyword">index</span>;</span><br><span class="line">    <span class="keyword">index</span> = host.lastIndexOf(<span class="string">'.'</span>, <span class="keyword">last</span> - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  var domain = host.substring(<span class="keyword">index</span> + <span class="number">1</span>);    </span><br><span class="line">  <span class="keyword">return</span> domain.length &amp;<span class="keyword">gt</span>; <span class="number">6</span> ? domain : host;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>引方法只能针对部分域名，对于 xxxx.com.cn xxxx.co.in xxxxx.com xxx.in 都是可以识别的，但如果域名长度小于tld， 比如 xxx.com.cn 这样的就无法判断出来。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313819/奥尔森《集体行动的逻辑》/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313819/奥尔森《集体行动的逻辑》/" itemprop="url">奥尔森《集体行动的逻辑》</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-28T12:51:42+08:00">2014-05-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/转载/" itemprop="url" rel="index"><span itemprop="name">转载</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">424</span></span></div></header><div class="post-body" itemprop="articleBody"><p>原文：<a href="http://www.ruanyifeng.com/blog/2006/11/the_logic_of_collective_action_public_goods_and_the_theory_of_groups.html" title="http://www.ruanyifeng.com/blog/2006/11/the_logic_of_collective_action_public_goods_and_the_theory_of_groups.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2006/11/the_logic_of_collective_action_public_goods_and_the_theory_of_groups.html</a></p><p>这几天，我就在看这本书。它是制度经济学领域的名著，出版于1965年，作者奥尔森（Mancur Olson，1932－1998）是马里兰大学的教授，已经去世了。</p><p>它问了一个很简单的问题：<strong>人们什么会组成集团？</strong></p><p>传统的看法是，因为人们有共同利益，所以组成集团后，便于采取行动维护共同利益。</p><p>但是奥尔森回答说，不是这样。</p><p>人们之所以会加入集团，是因为集团本质上提供了一种集体性的公共商品（public good），也就是说，如果不加入，就享受不到特殊利益。比如，在西方某些企业只雇佣工会成员，所以只有加入工会，才能到该企业就业。再比如，只有加入美国医疗协会，才能在美国行医。</p><p>因此，奥尔森说，<strong>本质上集团的存在是一种”搭便车”行为（free ride）</strong>。只有当一个集团能够提供排他性的个人收益时，这个集团才能存在下去。</p><p>从这一点出发，可以得到两点推论。</p><p>（1）如果当一个集团为其成员提供的收益在下降，那么这个集团很可能就会走向衰弱。</p><p>（2）由于集团提供的是所有成员都可以享受的公共品，所以大集团的成员维护集团公共利益的动机会弱于小集团的成员，因为在大集团中，个人的贡献越大，他可以享受到的回报就越少。</p><p>[参考链接]</p><p>1. Wikpedia：<a href="http://en.wikipedia.org/wiki/Mancur_Olson" target="_blank" rel="noopener">Mancur Olson</a></p><p>2. Wikipedia：<a href="http://en.wikipedia.org/wiki/The_Logic_of_Collective_Action" target="_blank" rel="noopener">The Logic of Collective Action</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313817/二八定律和长尾理论/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313817/二八定律和长尾理论/" itemprop="url">二八定律和长尾理论</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-28T12:50:43+08:00">2014-05-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/转载/" itemprop="url" rel="index"><span itemprop="name">转载</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">716</span></span></div></header><div class="post-body" itemprop="articleBody"><p>（一）</p><p><a href="http://www.ruanyifeng.com/blog/upload/2006/10/bg06102701.html" target="_blank" rel="noopener"><img src="http://www.ruanyifeng.com/blog/upload/2006/10/bg06102701-thumb.png" alt=""></a></p><p>上面这张图是统计学中很常见的一个图形，一般将它称为二八定律。它是１９世纪末２０世纪初意大利经济学家帕累托发现的，因为也被叫做”帕累托定律”。这个定律的内容是： &gt;</p><p>在任何一组东西中，最重要的只占其中一小部分，约２０％，其余８０％尽管是多数，却是次要的。</p><p>在图形上看就是，20%的样本点占据了曲线下80%的面积，其余80%的样本点形成了一个只占20%面积的长尾巴。</p><p>这种现象在日常生活中非常常见，比如，20%的人占有的全社会80%的财富；商店80%的营业额是20%的商品产生的；你的英语单词量是10000个，但你经常使用的，不过只是其中的2000个单词。</p><p>（二）</p><p>2004年，<em>Wired</em>杂志的编辑Chris Anderson发表了一篇文章，在”二八定律”的基础上提出了”长尾理论”。</p><p>虽然都是基于同样的统计图形，但是”长尾理论”与”二八定律”的涵义截然相反。”长尾理论”提出： &gt;</p><p>80%次要用户的那根”长尾巴”是很重要的。</p><p>“长尾理论”主要用来解释，像Amazon那样的网上书店为什么能够成功。这个理论提出，访问者能够在Amazon的网站上找到各种各样的书，因此这根长尾巴可以转变为销售量，而在实体书店中是没有办法找到这么多书的。所以，Amazon可以将潜在市场转变为销售量。</p><p>（三）</p><p>下面就是一个有趣的问题： &gt;</p><p>作为一个个人，你是愿意处在那重要的20%的”少数”之中，还是愿意处在那根80%的”长尾巴”之中？</p><p>好消息是，根据”长尾理论”，在信息时代，个性化需求更容易得到满足，所以在”长尾巴”之中有更大的机会发展你的个性。</p><p>坏消息是，根据”二八定律”，”长尾”部分和”主干”部分的差异会非常明显，而且会越来越明显。</p><p>让我们来考虑搜索引擎的例子：市场上有许多搜索引擎，但是80%以上的市场份额是被两三家主导公司占领的，比如Google和Yahoo!，这是”二八定律”。那么其他众多小型搜索引擎应该怎么办？”长尾理论”的建议是，如果你没有办法做得比Google和Yahoo!更出色，那么就应该盯住那根”长尾巴”，注重满足用户的个性化需求。</p><p>同样道理，走好人生的道路，其实也只有两种方法：一是专业化，二是成为本领域中最优秀的。</p><p>（完）</p><p>[参考链接]</p><p>1. Wikipedia: <a href="http://en.wikipedia.org/wiki/Long_tail" target="_blank" rel="noopener">The Long Tail</a></p><p>2. Wikipedia: <a href="http://en.wikipedia.org/wiki/Pareto_principle" target="_blank" rel="noopener">Pareto principle</a></p><p>原文：<a href="http://www.ruanyifeng.com/blog/2006/10/pareto_principle_and_the_long_tail.html" title="http://www.ruanyifeng.com/blog/2006/10/pareto_principle_and_the_long_tail.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2006/10/pareto_principle_and_the_long_tail.html</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313815/怀疑的价值/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313815/怀疑的价值/" itemprop="url">怀疑的价值</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-28T10:30:19+08:00">2014-05-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/转载/" itemprop="url" rel="index"><span itemprop="name">转载</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1,127</span></span></div></header><div class="post-body" itemprop="articleBody"><p>昨天，我说我想推荐二部电影。</p><p>一部是故事片<a href="http://www.ruanyifeng.com/blog/2009/02/gran_torino.html" target="_blank" rel="noopener">《Gran Torino》</a>,另一部就是今天想说的纪录片<a href="http://www.imdb.com/title/tt0815241/" target="_blank" rel="noopener">《Religulous》</a>，中文名为《宗教的荒谬》。</p><p><img src="http://lh5.ggpht.com/_6p3hNkUNWrQ/SYbwlka0lpI/AAAAAAAAArY/5_1kfvmqsfY/s800/bg2009020201.jpg" alt=""></p><p>如果你去查词典，里面是没有Religulous这个词的。它是由主持人比尔·马赫(Bill Maher)创造出来的，意为religious(宗教)和ridiculous(荒谬)的合成。比尔·马赫就是想探讨下面这个问题： &gt;</p><p>为什么有人相信那些荒诞的宗教传说？</p><p>据说，世界是由上帝创造出来的，圣母玛丽亚生下耶稣的时候还是处女，人死后灵魂会升入天堂……这些东西真的有人相信，而且是很多人相信。比尔·马赫走遍美国，采访不同的信徒，请他们解释为什么。这就是纪录片《Religulous》的主要内容。</p><p>它的可看性非常强，根据<a href="http://en.wikipedia.org/wiki/Religulous" target="_blank" rel="noopener">wikipedia</a>的资料，该片是去年美国票房最高的纪录片(2008年10月上映)，在历史上所有纪录片中排名第7位。如果你想了解美国社会中的宗教状况，这部纪录片是必看的。</p><p>==========================</p><p>下面，我想谈谈我的感想。</p><p>我觉得，从思想层面看，这部作品的价值并不大。</p><p>因为，我认为比尔·马赫将宗教和宗教传说混为一谈了。宗教传说是荒唐的，但是宗教本身是有其合理性的。你不能因为”创世纪”的传说是荒唐的，就推定基督教也是荒唐的。宗教传说不等于宗教精神和宗教情怀。很多人相信宗教，不是因为相信上帝创造了一切，而是因为他们需要精神的安慰和寄托。</p><p>《圣经》是不是真的，与基督教应不应该存在，完全就是两回事。《Religulous》犯的错误就是，好像相信基督教就等于相信《圣经》中的每一句话。所以，我觉得这个片子不是很深刻，批判深度不够，最多只是社会风俗的记录而已。</p><p>========================</p><p>但是，比尔·马赫在片中说了一段很精彩的话，这才是我今天真正想说的东西： &gt;</p><p><strong>My big thing is I don’t know.</strong></p><p><strong>我的问题是我不相信。</strong></p><p><strong>That is What I preach. I preach the gospel of I don’t know!</strong></p><p><strong>这就是我要传播的东西。我所散布的福音，就是我不相信！</strong></p><p><strong>I mean that’s what I’m here promoting–doubt. That is my product. The other guys are selling certainty, not me.</strong></p><p><strong>我就是在推销怀疑！这就是我的产品。其他人出售的是让你相信，我出售的是让你怀疑。</strong></p><p>我觉得这段话说得好极了！</p><p>怀疑是一切科学的起点。因为只有你怀疑了，你才不会盲从；只有你不盲从了，你才不会犯前人的错误；只有你不犯前人的错误，你才会做出新的东西；只有做出新的东西，你才能创造一个更美好的世界。</p><p><strong>我的网志其实就是在做这件事：我在推销怀疑！</strong></p><p>这个网志的一个目的，就是我想示范，独立思考是可以做到的，而且一点都不难。我不在乎别人认为我说的是对是错，我只希望你看了我的文章以后，自己也开始独立思考，开始用理性批判的精神进行怀疑。因为怀疑现行的秩序，这正是通往民主与科学的唯一道路。</p><p>我始终认为，中国人最落后的地方，就是思想太落后。大多数中国人的思想境界，还停留在封建时代。如果思想没有实现现代化，专制和愚昧就永远在这块土地上有市场。如果我们要建立一个民主和科学的新中国，那么第一步就是要改造人们的思想。而改造思想的第一步，就是传播怀疑。</p><p>如果大多数人不相信别人告诉他们的话，学会用自己的大脑，判断眼前发生的一切。凡事先想一想为什么，学会用不同来源的信息比对真伪，学会用逻辑的法则判断不同主张的合理性。那么，谎言就会无法生存，专制的基础就会动摇，中国发生变革的时刻，也就到来了。</p><p>[延伸阅读]</p><p>* <a href="http://www.ruanyifeng.com/blog/2006/12/how_to_get_an_idea.html" target="_blank" rel="noopener">如何变得有思想？</a></p><p>（完）</p><p>原文： <a href="http://www.ruanyifeng.com/blog/2009/02/value_of_doubt.html" title="http://www.ruanyifeng.com/blog/2009/02/value_of_doubt.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2009/02/value_of_doubt.html</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313808/7-天打造前端性能监控系统/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313808/7-天打造前端性能监控系统/" itemprop="url">7 天打造前端性能监控系统</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-28T03:49:11+08:00">2014-05-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/转载/" itemprop="url" rel="index"><span itemprop="name">转载</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4,968</span></span></div></header><div class="post-body" itemprop="articleBody"><p>百度FEX上的一篇文章，感觉很不错。</p><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>前阵子在<a href="http://www.w3ctech.com/" target="_blank" rel="noopener">w3ctech</a>的<a href="http://www.w3ctech.com/event/34" target="_blank" rel="noopener">走进名企 - 百度前端 FEX 专场</a>上曾“夸下海口”说听完讲座后七天就可以打造自己的前端性能监控系统，既然说出去了也不能食言。从前一篇文章<a href="http://fex.baidu.com/blog/2014/05/front_end-data/" target="_blank" rel="noopener">前端数据之美</a>相信大家对前端数据有了一定的了解，下面就针对其中的性能数据及其监控进行详细阐述。</p><h2 id="开始行动"><a href="#开始行动" class="headerlink" title="开始行动"></a>开始行动</h2><p>本文中的性能主要指 web 页面加载性能，对性能还不了解？不用担心，接下来的“每一天”跟我一起进入前端性能的世界。</p><h3 id="Day-1-为什么要监控性能？"><a href="#Day-1-为什么要监控性能？" class="headerlink" title="Day 1 为什么要监控性能？"></a>Day 1 为什么要监控性能？</h3><blockquote><p>“If you cannot measure it, you cannot improve it” ———— William Thomson</p></blockquote><p>这是一个最基本的问题，为什么要关注和监控前端性能？对于公司来说，性能在一定程度上与利益直接相关。国外有很多这方面的调研数据：</p><table><thead><tr><th>性能</th><th style="text-align:center">收益</th></tr></thead><tbody><tr><td>Google 延迟 <strong>400ms</strong></td><td style="text-align:center">搜索量下降 <strong>0.59%</strong></td></tr><tr><td>Bing 延迟 <strong>2s</strong></td><td style="text-align:center">收入下降 <strong>4.3%</strong></td></tr><tr><td>Yahoo 延迟 <strong>400ms</strong></td><td style="text-align:center">流量下降 <strong>5-9%</strong></td></tr><tr><td>Mozilla 页面打开减少 <strong>2.2s</strong></td><td style="text-align:center">下载量提升 <strong>15.4%</strong></td></tr><tr><td>Netflix 开启 Gzip</td><td style="text-align:center">性能提升 13.25% 带宽减少<strong>50%</strong></td></tr></tbody></table><p>数据来源：<a href="http://www.slideshare.net/bitcurrent/impact-of-web-latency-on-conversion-rates" target="_blank" rel="noopener">http://www.slideshare.net/bitcurrent/impact-of-web-latency-on-conversion-rates</a> <a href="http://stevesouders.com/docs/jsdayit-20110511.pptx" target="_blank" rel="noopener">http://stevesouders.com/docs/jsdayit-20110511.pptx</a></p><p>为什么性能会影响公司的收益呢？根本原因还是在于<strong>性能影响了用户体验</strong>。加载的延迟、操作的卡顿等都会影响用户的使用体验。尤其是移动端，用户对页面响应延迟和连接中断的容忍度很低。想象一下你拿着手机打开一个网页想看到某个信息却加载半天的心情，你很可能选择直接离开换一个网页。谷歌也将页面加载速度作为 SEO 的一个权重，页面加载速度对用户体验和 SEO 的影响的调研有<a href="http://www.webpronews.com/how-page-load-speed-impacts-seo-and-user-experience-2013-04" target="_blank" rel="noopener">很多</a>。</p><p>尽管性能很重要，开发迭代过程中难免会有所忽视，<strong>性能会伴随产品的迭代而有所衰减</strong>。特别在移动端，网络一直是一个很大的瓶颈，而页面却越来越大，功能越来越复杂。并没有简单的几条黄金规则就可以搞定性能优化工作，我们需要一套性能监控系统持续监控、评估、预警页面性能状况、发现瓶颈，指导优化工作的进行。</p><h3 id="Day-2-有什么可用的工具？"><a href="#Day-2-有什么可用的工具？" class="headerlink" title="Day 2 有什么可用的工具？"></a>Day 2 有什么可用的工具？</h3><blockquote><p>工欲善其事必先利其器</p></blockquote><p>页面性能的评估与监控有很多成熟优秀的工具，合理利用已有工具能达到事半功倍的效果。下面简单介绍几个常用的工具：</p><h4 id="Page-Speed"><a href="#Page-Speed" class="headerlink" title="Page Speed"></a>Page Speed</h4><p>Page Speed 是谷歌开发的分析和优化网页的工具，可以作为浏览器插件使用。工具基于一系列优化规则对网站进行检测，对于未通过的规则会给出详细的建议。与此类似的工具还有 Yslow 等，推荐使用<a href="http://gtmetrix.com/" target="_blank" rel="noopener">gtmetrix</a>网站同时查看多个分析工具的结果，如下图所示：</p><p><img src="http://fex.baidu.com/img/build-performance-monitor-in-7-days/gtmetrix.png" alt="gtmetrix"></p><h4 id="WebPagetest"><a href="#WebPagetest" class="headerlink" title="WebPagetest"></a>WebPagetest</h4><p>WebPageTest 是一款非常优秀的网页前端性能测试工具,已<a href="https://github.com/WPO-Foundation/webpagetest" target="_blank" rel="noopener">开源</a>。可以使用<a href="http://www.webpagetest.org/" target="_blank" rel="noopener">在线版</a>，也可以自己搭建。国内也有利用 WebPagetest 搭建的性能测试平台，推荐使用<a href="http://alibench.com/" target="_blank" rel="noopener">阿里测</a> (以下示例使用阿里测进行测试)。</p><p>使用 WebPagetest，你可以详细掌握网站加载过程中的瀑布流、性能得分、元素分布、视图分析等数据。其中比较直观的视图分析功能可以直接看到页面加载各个阶段的截屏:</p><p><img src="http://fex.baidu.com/img/build-performance-monitor-in-7-days/webpagetest.png" alt="webpagetest"></p><p><code>注</code>: 整个测试结果请点击<a href="http://alibench.com/rp/ca2e5911093626aacb0b136f5d55ced0" target="_blank" rel="noopener">此处</a></p><p>上图直观地展现了浏览类网站两个重要的时间点：白屏时间和首屏时间，即用户多久能在页面中看到内容，以及多久首屏渲染完成(包含图片等元素加载完成)。这两个时间点直接决定了用户需要等待多久才能看到自己想看到的信息。谷歌优化建议中也提到减少非首屏使用的 css 及 JS,尽快让首屏呈现。</p><h4 id="PhantomJS"><a href="#PhantomJS" class="headerlink" title="PhantomJS"></a>PhantomJS</h4><p><a href="http://phantomjs.org/" target="_blank" rel="noopener">PhantomJS</a>轻松地将监控带入了自动化的行列。Phantom JS 是一个服务器端的 JavaScript API 的 WebKit，基于它可以轻松实现 web 自动化测试。PhantomJS 需要一定编程工作，但也更灵活。官方文档中已经有一个完整的获取网页加载 har 文件的示例，具体说明可以查看<a href="https://github.com/ariya/phantomjs/wiki/Network-Monitoring" target="_blank" rel="noopener">此文档</a>，国内也有不少关于此工具的介绍。另外新浪<a href="http://weibo.com/itapir" target="_blank" rel="noopener">@貘吃馍香</a>开发的类似工具<strong>berserkJS</strong>也挺不错，还贴心的提供了<strong>首屏统计</strong>的功能，具体文章可以查看<a href="http://tech.weibo.com/?p=2150" target="_blank" rel="noopener">此处</a>。</p><h3 id="Day-3-开始线上真实用户性能监控"><a href="#Day-3-开始线上真实用户性能监控" class="headerlink" title="Day 3 开始线上真实用户性能监控"></a>Day 3 开始线上真实用户性能监控</h3><blockquote><p>取其所长，避其所短</p></blockquote><p>到此肯定有同学问，既然有这么多优秀的工具，为什么要监控线上用户真实访问性能呢？</p><p>我们发现，工具模拟测试会在一定程度上与<strong>真实情况偏离</strong>，有时无法反映性能的波动情况。另外除了白屏首屏之类的基础指标，产品线同样关注<strong>产品相关的指标</strong>，例如广告可见、搜索可用、签到可用等，这些功能直接与页面 JS 加载相关,通过工具较难模拟。</p><p>为了持续监控不同网络环境下用户访问情况与页面各功能可用状况，我们选择在页面中植入 JS 来监控线上真实用户访问性能，同时利用已有的分析工具作为辅助，形成一套完整多元的数据监控体系，为产品线的评估与优化提供可靠的数据。</p><p>关于不同监控方式的简单对比可以查看下表：</p><table><thead><tr><th>类型</th><th style="text-align:center">优点</th><th style="text-align:right">缺点</th><th style="text-align:right">示例</th></tr></thead><tbody><tr><td>非侵入式</td><td style="text-align:center">指标齐全、客户端主动监测、竞品监控</td><td style="text-align:right">无法知道性能影响用户数、采样少容易失真、无法监控复杂应用与细分功能</td><td style="text-align:right">Pagespeed、PhantomJS、UAQ</td></tr><tr><td>侵入式</td><td style="text-align:center">真实海量用户数据、能监控复杂应用与业务功能、用户点击与区域渲染</td><td style="text-align:right">插入脚本统计、网络指标不全、无法监控竞品</td><td style="text-align:right">DP 、Google 统计</td></tr></tbody></table><h3 id="Day-4-如何采集性能数据？"><a href="#Day-4-如何采集性能数据？" class="headerlink" title="Day 4 如何采集性能数据？"></a>Day 4 如何采集性能数据？</h3><blockquote><p>监控用户的痛点</p></blockquote><p>线上监控哪些指标呢？如何更好地反映用户感知？</p><p>对于用户来说他感觉到的为什么页面打不开、为什么按钮点击不了、为什么图片显示这么慢。而对于工程师来说，可能关注的是 DNS 查询、TCP 连接、服务响应等浏览器加载过程指标。我们根据用户的痛点，将浏览器加载过程抽取出四个关键指标，即白屏时间、首屏时间、用户可操作、总下载时间(定义可见<a href="http://fex.baidu.com/blog/2014/05/front_end-data/" target="_blank" rel="noopener">上篇文章</a>)。这些指标是如何统计的呢？</p><h4 id="确定统计起点"><a href="#确定统计起点" class="headerlink" title="确定统计起点"></a>确定统计起点</h4><p>我们需要在用户输入 URL 或者点击链接的时候就开始统计，因为这样才能衡量用户的等待时间。如果你的用户高端浏览器占比很高，那么可以直接使用<a href="http://www.html5rocks.com/en/tutorials/webperformance/basics/?redirect_from_locale=zh" target="_blank" rel="noopener">Navigation Timing</a>接口来获取统计起点以及加载过程中的各个阶段耗时。另外也可以通过 cookie 记录时间戳的方式来统计，需要注意的是 Cookie 方式只能统计到站内跳转的数据。</p><h4 id="统计白屏时间"><a href="#统计白屏时间" class="headerlink" title="统计白屏时间"></a>统计白屏时间</h4><p>白屏时间是用户首次看到内容的时间，也叫做首次渲染时间，chrome 高版本有 firstPaintTime 接口来获取这个耗时，但大部分浏览器并不支持，必须想其他办法来监测。仔细观察 WebPagetest 视图分析发现，白屏时间出现在<strong>头部外链资源加载完</strong>附近，因为浏览器只有加载并解析完头部资源才会真正渲染页面。基于此我们可以通过获取头部资源加载完的时刻来近似统计白屏时间。尽管并不精确，但却考虑了影响白屏的主要因素：首字节时间和头部资源加载时间。</p><p>如何统计头部资源加载呢？我们发现头部内嵌的 JS 通常需等待前面的 JS\CSS 加载完才会执行，是不是可以在浏览器 head 内底部加一句 JS 统计头部资源加载结束点呢？可以通过一个简单的示例进行测试：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> start_time = +<span class="keyword">new</span> <span class="built_in">Date</span>; <span class="comment">//测试时间起点，实际统计起点为 DNS 查询</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3s 后这个 js 才会返回 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"script.php"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> end_time = +<span class="keyword">new</span> <span class="built_in">Date</span>; <span class="comment">//时间终点</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> headtime = end_time - start_time; <span class="comment">//头部资源加载时间    </span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(headtime);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>在头部资源加载完之前页面将是白屏<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>script.php 被模拟设置 3s 后返回，head 底部内嵌 JS 等待前面 js 返回后才执行<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>script.php 替换成一个执行长时间循环的 js 效果也一样<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>经测试发现，统计的头部加载时间正好跟头部资源下载时间相近，而且换成一个执行时间很长的 JS 也会等到 JS 执行完才统计。说明此方法是可行的(具体原因可查看浏览器渲染原理及 JS 单线程相关介绍)。</p><h4 id="统计首屏时间"><a href="#统计首屏时间" class="headerlink" title="统计首屏时间"></a>统计首屏时间</h4><p>首屏时间的统计比较复杂，因为涉及图片等多种元素及异步渲染等方式。观察加载视图可发现，影响首屏的主要因素的图片的加载。通过统计首屏内图片的加载时间便可以获取首屏渲染完成的时间。统计流程如下：</p><blockquote><p>首屏位置调用 API 开始统计 -&gt; 绑定首屏内所有图片的 load 事件 -&gt; 页面加载完后判断图片是否在首屏内，找出加载最慢的一张 -&gt; 首屏时间</p></blockquote><p>这是同步加载情况下的简单统计逻辑，另外需要注意的几点：</p><ul><li>页面存在 iframe 的情况下也需要判断加载时间</li><li>gif 图片在 IE 上可能重复触发 load 事件需排除</li><li>异步渲染的情况下应在异步获取数据插入之后再计算首屏</li><li>css 重要背景图片可以通过 JS 请求图片 url 来统计(浏览器不会重复加载)</li><li>没有图片则以统计 JS 执行时间为首屏，即认为文字出现时间</li></ul><h4 id="统计用户可操作和总下载"><a href="#统计用户可操作和总下载" class="headerlink" title="统计用户可操作和总下载"></a>统计用户可操作和总下载</h4><p><strong>用户可操作</strong>默认可以统计<strong>domready</strong>时间，因为通常会在这时候绑定事件操作。对于使用了模块化异步加载的 JS 可以在代码中去主动标记重要 JS 的加载时间，这也是产品指标的统计方式。</p><p><strong>总下载时间</strong>默认可以统计<strong>onload</strong>时间，这样可以统计同步加载的资源全部加载完的耗时。如果页面中存在很多异步渲染，可以将异步渲染全部完成的时间作为总下载时间。</p><h4 id="网络指标"><a href="#网络指标" class="headerlink" title="网络指标"></a>网络指标</h4><p>网络类型判断</p><p>对于移动端来说，网络是页面加载速度最大的影响因素，需要根据不同的网络来采取相应的优化措施，例如对于 2G 用户采用简版等。但 web 上没有接口获取用户的网络类型。为了获取用户网络类型，可以通过测速的方式来判断不同 IP 段对应的网络。测速例如比较经典的有 facebook 的<a href="http://velocity.oreilly.com.cn/2011/ppts/MobilePerformanceVelocity2011_DavidWei.pdf" target="_blank" rel="noopener">方案</a>。经过测速后的分析，用户的加载速率有明显的分布区间，如下图所示：</p><p><img src="http://fex.baidu.com/img/build-performance-monitor-in-7-days/net.png" alt="gtmetrix"></p><p>各个分布区间正好对应不同的网络类型，经过与客户端的辅助测试，成功率可以在 95%以上。有了这个 IP 库对应的速率数据，就可以在分析用户数据时根据 IP 来判断用户网络类型。</p><p>网络耗时统计</p><p>网络耗时数据可以借助前面提到 Navigation Timing 接口获取，与之类似的还有<a href="http://www.w3.org/TR/2014/CR-resource-timing-20140325/" target="_blank" rel="noopener">Resource Timing</a>,可以获取页面所有静态资源的加载耗时。通过此接口可以轻松获取 DNS、TCP、首字节、html 传输等耗时，Navigation Timing 的接口示意图如下所示：</p><p><img src="http://fex.baidu.com/img/build-performance-monitor-in-7-days/timing.png" alt="gtmetrix"></p><p>以上重点介绍了数据采集部分，这也是系统中最关键的一部分，只有保证数据能真实反映用户感知，才能对症下药提升用户体验。数据采集完之后我们可以在页面加载完之后统一上报，如示例：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.baidu.<span class="keyword">com</span>/<span class="keyword">tj</span>.gif?dns=<span class="number">100</span>&amp;ct=<span class="number">210</span>&amp;<span class="keyword">st</span>=<span class="number">300</span>&amp;tt=<span class="number">703</span>&amp;c_dnslookup=<span class="number">0</span>&amp;c_connecting=<span class="number">0</span>&amp;c_waiting=<span class="number">296</span>&amp;c_receiving=<span class="number">403</span>&amp;c_fetch_dns=<span class="number">0</span>&amp;c_nav_dns=<span class="number">75</span>&amp;c_nav_fetch=<span class="number">75</span>&amp;drt=<span class="number">1423</span>&amp;drt_end=<span class="number">1436</span>&amp;<span class="keyword">lt</span>=<span class="number">3410</span>&amp;c_nfpt=<span class="number">619</span>&amp;nav_type=<span class="number">0</span>&amp;redirect_count=<span class="number">0</span>&amp;_screen=<span class="number">1366</span>*<span class="number">768</span>|<span class="number">1366</span>*<span class="number">728</span>&amp;product_id=<span class="number">10</span>&amp;page_id=<span class="number">200</span>&amp;_t=<span class="number">1399822334414</span></span><br></pre></td></tr></table></figure><h3 id="Day-5-如何分析性能数据？"><a href="#Day-5-如何分析性能数据？" class="headerlink" title="Day 5 如何分析性能数据？"></a>Day 5 如何分析性能数据？</h3><blockquote><p>让数据会说话</p></blockquote><p>而数据分析过程，如前一篇文章所述，可以从多个维度去分析数据。大数据处理需要借助 hadoop、Hive 等方式，而对于普通站点则任意一种后端语言处理即可。</p><p><strong>均值与分布</strong></p><p>均值与分布是数据处理中最常见的两种方式。因为它能直观的表示指标的趋势与分布状况，方便进行评估、瓶颈发现与告警。处理过程中应去除异常值，例如明显超过阈值的脏数据等。</p><p>耗时的评估中，有很多这方面的研究数据。例如<a href="http://www.nngroup.com/articles/response-times-3-important-limits/" target="_blank" rel="noopener">有人提出</a>三个基本的时间范围：</p><ul><li><strong>0.1秒</strong> : 0.1 秒是用户感知的最小粒度，在这个时间范围内完成的操作被认为是流畅没有延迟的</li><li><strong>1.0秒</strong> : 1.0 秒内完成的响应认为不会干扰用户的思维流。尽管用户能感觉到延迟，但 0.1 秒 -1.0 秒内完成的操作并不需要给出明显 loading 提示</li><li><strong>10秒</strong> : 达到 10 秒用户将无法保持注意力，很可能选择离开做其他事情</li></ul><p>我们根据业界的一些调研，结合不同指标的特点，制定了指标的分布评估区间。如下图所示：</p><p><img src="http://fex.baidu.com/img/build-performance-monitor-in-7-days/portion.png" alt="gtmetrix"></p><p>评估区间的制定方便我们了解当前性能状况，同时对性能趋势波动做出反应。</p><p><strong>多维分析</strong></p><p>为了方便挖掘性能可能的瓶颈，需要从多维的角度对数据进行分析。例如移动端最重要的维度就是网络，数据处理上除了总体数据，还需要根据网络类型对数据进行分析。常见的维度还有系统、浏览器、地域运营商等。我们还可以根据自身产品的特点来确定一些维度，例如页面长度分布、简版炫版等。</p><p>需要注意的是维度并不是越多越好，需要根据产品的特点及终端来确定。<strong>维度是为了方便查找性能瓶颈</strong>。</p><p><strong>小插曲</strong> ：之前从微博中看到有人评价说想做监控但是公司<strong>没有日志服务器</strong>。并不需要单独的日志服务器,只要能把统计的这个请求访问日志保存下来即可。如果网站自己的独立服务器都没有还有解决办法，在<a href="http://developer.baidu.com/" target="_blank" rel="noopener">百度开发者中心</a>新建一个应用，写一个简单的 Web 服务将接收到的统计数据解析存到百度云免费的数据库中，然后每天再用 Mysql 处理下当天的数据即可，对于普通站点的抽样性能数据应该没问题。请叫我雷锋。</p><h3 id="Day-6-如何利用监控数据解决问题？"><a href="#Day-6-如何利用监控数据解决问题？" class="headerlink" title="Day 6 如何利用监控数据解决问题？"></a>Day 6 如何利用监控数据解决问题？</h3><blockquote><p>发现瓶颈，对症下药</p></blockquote><p>对于图表制作，比较出名的有<a href="http://www.highcharts.com/" target="_blank" rel="noopener">Highcharts</a>，百度开发的<a href="http://echarts.baidu.com/" target="_blank" rel="noopener">Echarts</a>也很不错。不管使用什么工具，最关键的一点就是让报表能<strong>突出重点，直观明了</strong>。</p><p>制作报表前多问几个如何让人直观看到目前状况和可能存在的问题，哪些地方可以加强，哪些可以去掉，使用是否习惯等。</p><p><img src="http://fex.baidu.com/img/build-performance-monitor-in-7-days/rank.png" alt="gtmetrix"></p><p>有了能反映用户感知的真实世界、并且细分到各个业务功能，有详细的网络等辅助数据，我们在解决前端性能上便更加得心应手。监控系统已经对线上访问状况有了连续的反馈，根据现有评估与瓶颈选择对应方案进行优化，最后根据反馈进行调整，相信性能优化不再是个难题。</p><p><strong>如何选择优化方案呢</strong>？这又是一个比较大的话题了，好在已经有很多经验可以借鉴。附录中就整理了部分<strong>性能的学习资料</strong>，可以根据需要阅读学习。</p><p><img src="http://fex.baidu.com/img/build-performance-monitor-in-7-days/solution.png" alt="gtmetrix"></p><h3 id="Day-7-总结"><a href="#Day-7-总结" class="headerlink" title="Day 7 总结"></a>Day 7 总结</h3><p>通过以上“几天”的努力，我们可以搭建一个小而美的前端性能监控系统。但这仅仅是开始，前端数据有很多挖掘的价值。性能优化也是一门需要认真学习的课程，为了打造流畅的使用体验，为了让用户更加满意，赶紧搭建起自己的前端数据平台吧!</p><p>该文写在<a href="http://www.w3ctech.com/" target="_blank" rel="noopener">w3ctech</a>的<a href="http://www.w3ctech.com/event/34" target="_blank" rel="noopener">走进名企 - 百度前端 FEX 专场</a>之后，分享时的 PPT 在<a href="https://speakerdeck.com/baidufe/bai-du-qian-duan-ji-chu-shu-ju-ping-tai-jie-shao" target="_blank" rel="noopener">这里</a>，视频在<a href="http://v.youku.com/v_show/id_XNjk2NDYyNDI0.html" target="_blank" rel="noopener">这里</a>。</p><p><strong>华丽非分割线</strong> <del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del><del>~</del></p><h2 id="福利——前端性能学习资料整理"><a href="#福利——前端性能学习资料整理" class="headerlink" title="福利——前端性能学习资料整理"></a>福利——前端性能学习资料整理</h2><h3 id="性能准则-★★★★★"><a href="#性能准则-★★★★★" class="headerlink" title="性能准则 ★★★★★"></a>性能准则 <code>★★★★★</code></h3><ul><li><a href="http://developer.yahoo.com/performance/rules.html" target="_blank" rel="noopener">雅虎性能军规</a>、<a href="http://www.cnblogs.com/li0803/archive/2009/09/20/1570581.html" target="_blank" rel="noopener">中文文章</a></li><li><a href="https://developers.google.com/speed/articles/" target="_blank" rel="noopener">谷歌性能优化文章</a> 推荐</li></ul><h3 id="分析工具-★★★"><a href="#分析工具-★★★" class="headerlink" title="分析工具 ★★★"></a>分析工具 <code>★★★</code></h3><p><strong>入门</strong></p><ul><li><a href="https://developers.google.com/speed/pagespeed/" target="_blank" rel="noopener">pageSpeed</a> 基于谷歌性能准则的检测，可浏览器安装插件运行</li><li><a href="http://www.yslow.net/show.php?tid=123" target="_blank" rel="noopener">Yslow</a> 基于雅虎性能准则的检测工具，可浏览器安装插件运行</li><li><a href="http://fe.baidu.com/pagecheck/" target="_blank" rel="noopener">pageCheck</a> 百度内部开发，指标齐全，支持自动运行</li></ul><p><strong>进阶</strong></p><ul><li><a href="http://www.webpagetest.org/" target="_blank" rel="noopener">webPageTest</a> 查看页面加载瀑布流等数据，进阶必备工具</li><li><a href="http://coding.smashingmagazine.com/2012/06/12/javascript-profiling-chrome-developer-tools/" target="_blank" rel="noopener">Chrome 开发者工具</a> 功能强大，值得学习</li><li><a href="http://phantomjs.org/" target="_blank" rel="noopener">PhantomJS</a> 功能强大的分析工具，高手必备瑞士军刀</li><li><a href="http://jsperf.com/" target="_blank" rel="noopener">JsPerf</a> JS 执行性能分析网站，谁用谁知道</li></ul><h3 id="浏览器与-Html-标准-★★"><a href="#浏览器与-Html-标准-★★" class="headerlink" title="浏览器与 Html 标准 ★★"></a>浏览器与 Html 标准 <code>★★</code></h3><p><strong>入门</strong></p><ul><li><a href="http://www.mangguo.org/browser-cache-mechanism-detailed/" target="_blank" rel="noopener">浏览器缓存机制</a></li><li><a href="http://www.w3.org/TR/navigation-timing/" target="_blank" rel="noopener">Navigation Timing</a>、<a href="http://www.w3.org/TR/resource-timing/" target="_blank" rel="noopener">Resource Timing</a> 相关文章请谷歌，必备知识</li><li><a href="http://www.ecdoer.com/post/dns.html" target="_blank" rel="noopener">DNS 解析过程原理</a></li><li><a href="http://blog.csdn.net/xingtian713/article/details/11882795" target="_blank" rel="noopener">高性能浏览器网络翻译系列</a></li></ul><p><strong>进阶</strong></p><ul><li><a href="http://network.51cto.com/art/201401/426957.htm" target="_blank" rel="noopener">SPDY 协议</a> 基于此的 Http2.0 协议即将发布</li><li><a href="http://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/" target="_blank" rel="noopener">浏览器渲染原理</a> 比较难懂，但是非常经典</li><li><a href="http://fe.baidu.com/doc/wpo/research/chromium-gettingstart-guide.text" target="_blank" rel="noopener">Chrome 实现原理学习指南</a> 多益大牛的总结</li></ul><h3 id="开发实战-★★★★"><a href="#开发实战-★★★★" class="headerlink" title="开发实战 ★★★★"></a>开发实战 <code>★★★★</code></h3><p><strong>通用</strong></p><ul><li><a href="http://book.douban.com/subject/5362856/" target="_blank" rel="noopener">高性能 JavaScript</a></li><li><a href="http://coding.smashingmagazine.com/2012/11/05/writing-fast-memory-efficient-javascript/" target="_blank" rel="noopener">writing-fast-memory-efficient-javascript</a></li><li><a href="http://msdn.microsoft.com/en-us/library/bb250448.aspx" target="_blank" rel="noopener">Understanding and Solving Internet Explorer Leak Patterns</a></li><li>模块化加载 <a href="https://fis.baidu.com/" target="_blank" rel="noopener">FIS</a>、SeaJS。FIS 有完善的静态资源管理和优化方案，推荐。</li><li><a href="http://www.iteye.com/magazines/116-Web-Front-Performance-Best-Practice" target="_blank" rel="noopener">前端性能优化最佳实践</a></li></ul><p><strong>动画与渲染</strong></p><ul><li><a href="http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/" target="_blank" rel="noopener">requestAnimationFrame</a></li><li><a href="http://velocity.oreilly.com.cn/2013/ppts/16_ms_optimization--web_front-end_performance_optimization.pdf" target="_blank" rel="noopener">16ms 的优化</a></li><li><a href="http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/" target="_blank" rel="noopener">css</a>、<a href="http://mir.aculo.us/2010/08/17/when-does-javascript-trigger-reflows-and-rendering/" target="_blank" rel="noopener">JS</a>不要引起 Repaint &amp; Reflow</li></ul><p><strong>移动端开发</strong></p><ul><li><a href="http://www.html5rocks.com/en/tutorials/speed/html5/" target="_blank" rel="noopener">Improving the Performance of your HTML5 App</a></li><li><a href="http://stevesouders.com/mobileperf/" target="_blank" rel="noopener">Steve Souders</a></li><li><a href="http://mobile.smashingmagazine.com/2013/08/12/creating-high-performance-mobile-websites/" target="_blank" rel="noopener">Creating High-Performance Mobile Websites</a></li><li><a href="http://www.html5rocks.com/en/mobile/optimization-and-performance/" target="_blank" rel="noopener">HTML5 Techniques for Optimizing Mobile Performance</a></li><li><a href="https://developers.google.com/webmasters/smartphone-sites/website-improvement-checklist" target="_blank" rel="noopener">移动 web 站点优化指南</a></li></ul><h3 id="性能监控-★★★★"><a href="#性能监控-★★★★" class="headerlink" title="性能监控 ★★★★"></a>性能监控 <code>★★★★</code></h3><ul><li><a href="http://blog.smartbear.com/performance/essential-web-performance-metrics-part-2/" target="_blank" rel="noopener">监控指标选取</a></li><li><a href="http://www.slideshare.net/watchingwebsites/complete-web-monitoring-web-performance-at-emetrics?qid=a6296849-f0ce-4c71-9322-0be0f6eedb27&amp;v=qf1&amp;b=&amp;from_search=11" target="_blank" rel="noopener">Complete Web Monitoring - Web Performance at eMetrics</a></li><li><a href="http://tech.weibo.com/?p=2150" target="_blank" rel="noopener">berserkJS 建立前端性能监控平台</a></li><li><a href="http://www.slideshare.net/catchpoint/ny-webperf-peelingonion?qid=a6296849-f0ce-4c71-9322-0be0f6eedb27&amp;v=qf1&amp;b=&amp;from_search=8" target="_blank" rel="noopener">NY Web Perf Meetup: Peeling the Web Performance Onion</a></li></ul><h3 id="相关会议-★★★"><a href="#相关会议-★★★" class="headerlink" title="相关会议 ★★★"></a>相关会议 <code>★★★</code></h3><ul><li><a href="http://velocity.oreilly.com.cn/2012/" target="_blank" rel="noopener">velocity</a> 业内最出名的国际会议之一</li><li><a href="https://developers.google.com/events/io/" target="_blank" rel="noopener">Google I/O</a></li><li><a href="http://www.qconbeijing.com/" target="_blank" rel="noopener">Qcon</a></li></ul><h3 id="推荐博客-★★★"><a href="#推荐博客-★★★" class="headerlink" title="推荐博客 ★★★"></a>推荐博客 <code>★★★</code></h3><ul><li><a href="http://www.webperformancetoday.com/" target="_blank" rel="noopener">web performance today</a></li><li><a href="http://www.perfplanet.com/" target="_blank" rel="noopener">perfplanet</a></li><li><a href="http://www.stevesouders.com/blog/" target="_blank" rel="noopener">stevesouders.com</a></li><li><a href="http://www.yottaa.com/blog/topic/site-performance-and-optimization" target="_blank" rel="noopener">site-performance-and-optimization</a></li></ul><p>作者：<a href="http://weibo.com/u/1733215473" target="_blank" rel="noopener">zhangtao (http://weibo.com/u/1733215473)</a> - 学无止境</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313806/pragma-short_column_names设置/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313806/pragma-short_column_names设置/" itemprop="url">SQLite pragma short_column_names设置</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-26T05:57:46+08:00">2014-05-26</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">504</span></span></div></header><div class="post-body" itemprop="articleBody"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PRAGMA</span> short_column_names;</span><br><span class="line"><span class="keyword">PRAGMA</span> short_column_names = <span class="number">0</span> | <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>查询或修改 short-column-names 标志。 该标志会影响当 SELECT 查询后面的列表是一个 “表-列名” 或 “*”时 SQLite返回列名的方式。 通常， 如果 SELECT 语句连接两个或多个表， 结果列名将是 &lt;表名/别名&gt;&lt;列名&gt;； 而若仅仅对单个表查询时，将是 。 但如果设置了 short-column-names 标志，列名将永远是 ， 而不管是只查询一个表或同时连接多个表。</p><p>如果 short-column-names 和 full-column-names 都设置了， 则以 full-column-names 标志为准。</p><p>如果在pdo sqlite中使用join查询时，返回的关联数组会带有表名，如table.filed形式的，如果你不想带有表名，使用<span style="color:#000"><code>PRAGMA short_column_names = ON</code>可强制取消。以下是具体的说明：</span></p><p><a href="http://www.php.net/manual/en/function.sqlite-fetch-array.php" target="_blank" rel="noopener">http://www.php.net/manual/en/function.sqlite-fetch-array.php</a></p><p>Typecho博客程序就有此问题，它会影响目录页面，导致目录页面无法获取文章，因为sqlite数据库下，返回的关联数组的key，都带有表名，但是在程序引用的时候，是没有带有表名的，会导致很多错误情况。</p><blockquote><p>[Editor’s note: to get short column names there’s an undocumented PRAGMA setting. You can exec “PRAGMA short_column_names = ON” to force that behavior.]</p><p> I noticed that if you use Joins in SQL queries, the field name is messed up with the dot!<br> for example if you have this query:<br> SELECT n.*, m.nickname FROM news AS n, members AS m WHERE n.memberID = m.id;</p><p> now if you want to print_r the results returned using SQLITE_ASSOC type, the result array is like this :<br> array<br> (<br> [n.memberID] =&gt; 2<br> [n.title] =&gt; test title<br> [m.nickname] =&gt; NeverMind<br> [tablename.fieldname] =&gt; value<br> )</p><p> and I think it looks horriable to use the variable ,for example, $news[‘m.nickname’] I just don’t like it!</p><p> so I’ve made a small function that will remove the table name (or its Alias) and will return the array after its index is cleaned<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">CleanName</span><span class="params">($array)</span> </span></span></span><br><span class="line"><span class="php">&#123; </span></span><br><span class="line"><span class="php">  <span class="keyword">foreach</span> ($array <span class="keyword">as</span> $key =&gt; $value) &#123; </span></span><br><span class="line"><span class="php">    <span class="comment">//if you want to keep the old element with its key remove the following line </span></span></span><br><span class="line"><span class="php">      <span class="keyword">unset</span>($array[$key]); </span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">  <span class="comment">//now we clean the key from the dot and tablename (alise) and set the new element </span></span></span><br><span class="line"><span class="php">      $key = substr($key, strpos($key, <span class="string">'.'</span>)+<span class="number">1</span>); </span></span><br><span class="line"><span class="php">      $array[$key] = $value; </span></span><br><span class="line"><span class="php">  &#125; </span></span><br><span class="line"><span class="php">  <span class="keyword">return</span> $array; </span></span><br><span class="line"><span class="php">&#125; </span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p></p></blockquote></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313803/google-算法与排名在本月调整/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313803/google-算法与排名在本月调整/" itemprop="url">google 算法与排名在本月调整</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-20T05:39:10+08:00">2014-05-20</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Google-SEO/" itemprop="url" rel="index"><span itemprop="name">Google SEO</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">354</span></span></div></header><div class="post-body" itemprop="articleBody"><p>Google前几日的排名算法发生了一些改变，可能是近期的又一次调整。Google每年都会频繁调整它的排名算法，这对英文SEO一块来说，是愈发难做了。目前来看，Google的这次调整主要的是针对网站外链因素的考虑。</p><p>原文： <a href="http://www.seroundtable.com/google-update-march-18313.html" target="_blank" rel="noopener">Google Algorithm &amp; Ranking Shifts On Fire This Month</a></p><p>Despite Google saying <a href="http://www.seroundtable.com/google-denies-update-18539.html" target="_blank" rel="noopener">nothing is going on</a>, we’ve been seeing <a href="http://www.seroundtable.com/google-update-algorithm-18526.html" target="_blank" rel="noopener">signs</a> of major <a href="http://www.seroundtable.com/google-update-reversal-18536.html" target="_blank" rel="noopener">changes</a> and <a href="http://www.branded3.com/blogs/new-google-softer-panda-update-2-0-hits-media-sites-hard/" target="_blank" rel="noopener">reports</a> of major changes in the Google search results and rankings.</p><p>Again, over the weekend, I’ve been getting private emails with tons of public chatter in the<a href="http://www.webmasterworld.com/google/4667620.htm" target="_blank" rel="noopener">WebmasterWorld</a> and even <a href="http://www.blackhatworld.com/blackhat-seo/black-hat-seo/674254-penguin-3-0-a.html" target="_blank" rel="noopener">BlackHatWorld</a> forums about Google making a lot of changes over the weekend.</p><p>Some are suspecting a massive Penguin update is about to hit, while others think it might be a Panda refresh and others think it is just Google’s normal actions on link networks. It is almost impossible to tell without a confirmation from Google, for all we know, it can be all three or more.</p><p>Even the tracking tools are all over the place, it seems like it even broke <a href="http://mozcast.com/" target="_blank" rel="noopener">MozCast</a>,<a href="https://serps.com/tools/volatility" target="_blank" rel="noopener">SERPS.com</a> shows major activity on Saturday, so does <a href="http://serpmetrics.com/flux/" target="_blank" rel="noopener">SERP Metrics</a> and <a href="http://algoroo.com/" target="_blank" rel="noopener">Algoroo</a>.</p><p><a href="http://images.seroundtable.com/serps-1400504074.png" target="_blank" rel="noopener"><img src="http://images.seroundtable.com/t-serps-1400504074.png" alt="click for full size"></a></p><p><a href="http://images.seroundtable.com/serpmetrics-1400504074.png" target="_blank" rel="noopener"><img src="http://images.seroundtable.com/t-serpmetrics-1400504074.png" alt="click for full size"></a></p><p><a href="http://images.seroundtable.com/algoroo-1400504074.png" target="_blank" rel="noopener"><img src="http://images.seroundtable.com/t-algoroo-1400504074.png" alt="click for full size"></a></p><p>Here are some recent chatter comments from the forums:</p><blockquote><p>Regardless of the weather anywhere overall my lowest-ever page views at 45.7% of 2014 average with the UK at 37.4% however fortunately not as bad as Friday at 26.5%, what a mess.</p></blockquote><blockquote><p>i did a small analysis.. i used two of my sites and ranked purely with GSA and 10 articles scraped and smashed one was used. it got hit.&nbsp;</p><p>for my one another site i used 5 unique articles, spun with wordai, smashed as 1 articles with GSA.. it got hit but only 4-9 position drops.. not like first one..</p><p>so its getting clear that its penguin 3.0</p></blockquote><p>Forum discussion at <a href="http://www.webmasterworld.com/google/4667620.htm" target="_blank" rel="noopener">WebmasterWorld</a> and <a href="http://www.blackhatworld.com/blackhat-seo/black-hat-seo/674254-penguin-3-0-a.html" target="_blank" rel="noopener">BlackHatWorld</a>.</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://love4026.org/313795/wordpress-相关阅读插件功能增强/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray Chang"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Ray's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/313795/wordpress-相关阅读插件功能增强/" itemprop="url">wordpress 相关阅读插件功能增强</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-19T04:37:12+08:00">2014-05-19</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Wordpress学习/" itemprop="url" rel="index"><span itemprop="name">Wordpress学习</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1,520</span></span></div></header><div class="post-body" itemprop="articleBody"><p>本站用到了“相关阅读”插件，在文章尾部显示相关文章的链接，该插件非常实用。但是最近发现一个问题，就是当新的文章发布时，新文章尾部可以关联到已有文章，但是在老文章的相关阅读的列表并没有加入新发布的文章。感觉，应该是发布了新文章后，没有重建整个关联关系。插件本身为了性能考虑，应该只刷新了当前文章的关联信息，而没有刷新其他文章的。下面的代码分析也印证了这一点。</p><p>首先需要了解插件的运行流程，这里顺带发一下Yet Another Related Posts Plugin的代码分析。</p><p>插件的主函数为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;yarppPro = get_option(<span class="string">'yarpp_pro'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;load_default_options();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Loads the plugin's translated strings. */</span></span><br><span class="line">    load_plugin_textdomain(<span class="string">'yarpp'</span>, <span class="keyword">false</span>, plugin_basename(YARPP_DIR).<span class="string">'/lang'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Load cache object. */</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;storage_class    = <span class="string">'YARPP_Cache_'</span>.ucfirst(YARPP_CACHE_TYPE);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;cache            = <span class="keyword">new</span> <span class="keyword">$this</span>-&gt;storage_class(<span class="keyword">$this</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;cache_bypass     = <span class="keyword">new</span> YARPP_Cache_Bypass(<span class="keyword">$this</span>);</span><br><span class="line"></span><br><span class="line">    register_activation_hook(<span class="keyword">__FILE__</span>, <span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="string">'activate'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.2 Update cache on delete.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    add_action(<span class="string">'delete_post'</span>, <span class="keyword">array</span>(<span class="keyword">$this</span>-&gt;cache, <span class="string">'delete_post'</span>), <span class="number">10</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.5.3 Use transition_post_status instead of save_post hook.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.2.1 Handle post_status transitions.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    add_action(<span class="string">'transition_post_status'</span>, <span class="keyword">array</span>(<span class="keyword">$this</span>-&gt;cache, <span class="string">'transition_post_status'</span>), <span class="number">10</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Automatic display hooks: */</span></span><br><span class="line">    add_filter(<span class="string">'the_content'</span>,        <span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="string">'the_content'</span>), <span class="number">1200</span>);</span><br><span class="line">    add_filter(<span class="string">'the_content_feed'</span>,   <span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="string">'the_content_feed'</span>), <span class="number">600</span>);</span><br><span class="line">    add_filter(<span class="string">'the_excerpt_rss'</span>,    <span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="string">'the_excerpt_rss'</span> ), <span class="number">600</span>);</span><br><span class="line">    add_action(<span class="string">'wp_enqueue_scripts'</span>, <span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="string">'maybe_enqueue_thumbnails'</span>));</span><br></pre></td></tr></table></figure><p>注意，其中的几个filter和action，filter是显示文章的时候调用的回调，action是增、删、改文章时的回调。这里重点关注action。delete_post，当删除文章时，需要删除该文章的关联信息，还要删除指向该文章的关联信息。分析代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Clear the cache for this entry and for all posts which are "related" to it.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.2 This is called when a post is deleted.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delete_post</span><span class="params">($post_ID)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Clear the cache for this post.</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;clear((int) $post_ID);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Find all "peers" which list this post as a related post and clear their caches</span></span><br><span class="line">    <span class="keyword">if</span> ($peers = <span class="keyword">$this</span>-&gt;related(<span class="keyword">null</span>, (int) $post_ID)) <span class="keyword">$this</span>-&gt;clear($peers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到这个函数分作两步，首先是删除当前文章的关联信息，接下来删除指向该文章的关联。</p><p>而修改文章状态，如：从草稿变成发布，从发布改为私密，等等，使用的是这个回调：</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_action(<span class="string">'transition_post_status'</span>, <span class="built_in">array</span>($this-&gt;<span class="keyword">cache</span>, <span class="string">'transition_post_status'</span>), <span class="number">10</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>当有文章的状态出现变化时，这个回调就会起作用：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.2.1 Handle various post_status transitions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transition_post_status</span><span class="params">( $new_status, $old_status, $post )</span> </span>&#123;</span><br><span class="line">    $post_ID = $post-&gt;ID;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.4 Don't compute on revisions</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.5 Compute on the parent instead</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> ($the_post = wp_is_post_revision($post_ID)) $post_ID = $the_post;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Un-publish</span></span><br><span class="line">    <span class="keyword">if</span> ($old_status === <span class="string">'publish'</span> &amp;amp;&amp;amp; $new_status !== <span class="string">'publish'</span>) &#123;</span><br><span class="line">        <span class="comment">// Find all "peers" which list this post as a related post and clear their caches</span></span><br><span class="line">        <span class="keyword">if</span> ($peers = <span class="keyword">$this</span>-&gt;related(<span class="keyword">null</span>, (int) $post_ID)) <span class="keyword">$this</span>-&gt;clear($peers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Publish</span></span><br><span class="line">    <span class="keyword">if</span> ($old_status !== <span class="string">'publish'</span> &amp;amp;&amp;amp; $new_status === <span class="string">'publish'</span>) &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Find everything which is related to this post, and clear them,</span></span><br><span class="line"><span class="comment">         * so that this post might show up as related to them.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> ($related = <span class="keyword">$this</span>-&gt;related($post_ID, <span class="keyword">null</span>)) <span class="keyword">$this</span>-&gt;clear($related);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.4 Simply clear the cache on save; don't recompute.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;clear((int) $post_ID);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，这里只处理当文章的状态从发布修改为非发布等情况，对于新增文章，这里应该是什么都不做，也就是说，新增文章的关联关系是在另外的地方建立，而且每一次文章展示时，都会检查是否有关联关系，如果没有，则会全新计算生成。</p><p>那么这里就有了解决上面提到的功能增强的方法了，每次有文章更改时，清空关联关系表即可。增加一个方法：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clearall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在基类（YARPP_Cache）中提供默认实现，如上，什么都不做，由管理关联关系表的子类来实现清空关联表即可，在YARPP_Cache_Tables类中提供如下实现：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clearall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $wpdb;</span><br><span class="line">    $wpdb-&gt;query(<span class="string">"TRUNCATE TABLE &#123;$wpdb-&gt;prefix&#125;"</span> . YARPP_TABLES_RELATED_TABLE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上述的delete_post和transition_post_status的回调中，增加这个方法的调用：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Clear the cache for this entry and for all posts which are "related" to it.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.2 This is called when a post is deleted.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delete_post</span><span class="params">($post_ID)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Clear the cache for this post.</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;clear((int) $post_ID);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;clearall();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Find all "peers" which list this post as a related post and clear their caches</span></span><br><span class="line">    <span class="keyword">if</span> ($peers = <span class="keyword">$this</span>-&gt;related(<span class="keyword">null</span>, (int) $post_ID)) <span class="keyword">$this</span>-&gt;clear($peers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.2.1 Handle various post_status transitions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transition_post_status</span><span class="params">( $new_status, $old_status, $post )</span> </span>&#123;</span><br><span class="line">    $post_ID = $post-&gt;ID;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.4 Don't compute on revisions</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.5 Compute on the parent instead</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> ($the_post = wp_is_post_revision($post_ID)) $post_ID = $the_post;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Un-publish</span></span><br><span class="line">    <span class="keyword">if</span> ($old_status === <span class="string">'publish'</span> &amp;amp;&amp;amp; $new_status !== <span class="string">'publish'</span>) &#123;</span><br><span class="line">        <span class="comment">// Find all "peers" which list this post as a related post and clear their caches</span></span><br><span class="line">        <span class="keyword">if</span> ($peers = <span class="keyword">$this</span>-&gt;related(<span class="keyword">null</span>, (int) $post_ID)) <span class="keyword">$this</span>-&gt;clear($peers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Publish</span></span><br><span class="line">    <span class="keyword">if</span> ($old_status !== <span class="string">'publish'</span> &amp;amp;&amp;amp; $new_status === <span class="string">'publish'</span>) &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Find everything which is related to this post, and clear them,</span></span><br><span class="line"><span class="comment">         * so that this post might show up as related to them.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> ($related = <span class="keyword">$this</span>-&gt;related($post_ID, <span class="keyword">null</span>)) <span class="keyword">$this</span>-&gt;clear($related);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 3.4 Simply clear the cache on save; don't recompute.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;clear((int) $post_ID);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;clearall();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，仅仅从操作关联关系表来看，在这两个方法中只需要clearall即可，其他流程都不需要，但是这个是基类，这个框架供各个子类使用，没有分析另外两个子类的功能，因此这里仅仅只增加clearall的流程，保留之前的已有实现。</p><p>在博客站点的文章数量不是特别多的情况下，该方法应该是非常有用的，如果文章特别多，则需要定点修改与该文章关联的文章的关联关系，将修改范围尽可能缩小，但是，可以想象，该实现将会非常复杂。建立关联关系的过程消耗站点的访问性能应该说是非常少的，如果只是访问一片文章，那么只会建这一篇文章的关联，不会全部创建，因此不会出现阻塞页面呈现的情况。</p><p>经过本站实测，该问题得到了解决。</p><p>来源：<a href="http://shentar.me/wordpress-%E7%9B%B8%E5%85%B3%E9%98%85%E8%AF%BB%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%A2%9E%E5%BC%BA/" target="_blank" rel="noopener">http://shentar.me/wordpress-%E7%9B%B8%E5%85%B3%E9%98%85%E8%AF%BB%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%A2%9E%E5%BC%BA/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a> <a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/logo.png" alt="Ray Chang"><p class="site-author-name" itemprop="name">Ray Chang</p><p class="site-description motion-element" itemprop="description">Think Difficulty</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">411</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">10</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">224</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/sbmzhcn" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://twitter.com/love4026/" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/106618658391372851068" target="_blank" title="Google Plus"><i class="fa fa-fw fa-google"></i> Google Plus</a></span><span class="links-of-author-item"><a href="https://www.facebook.com/love4026" target="_blank" title="Facebook"><i class="fa fa-fw fa-facebook"></i> Facebook</a></span><span class="links-of-author-item"><a href="https://www.v2ex.com/member/sbmzhcn" target="_blank" title="V2EX"><i class="fa fa-fw fa-globe"></i> V2EX</a></span><span class="links-of-author-item"><a href="mailto:love4026@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank"><img src="/images/cc-by-nc-nd.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://www.lanthy.com/" title="蓝悉" target="_blank">蓝悉</a></li><li class="links-of-blogroll-item"> <a href="http://www.shibang-china.com/" title="世邦中文" target="_blank">世邦中文</a></li><li class="links-of-blogroll-item"> <a href="http://www.sbmchina.com/" title="世邦英文" target="_blank">世邦英文</a></li><li class="links-of-blogroll-item"> <a href="http://www.kamychina.com/" title="科煤机电" target="_blank">科煤机电</a></li></ul></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">Copyright &copy; <span itemprop="copyrightYear">2018</span><span class="with-love" id="heart"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Chang. Allrights reserved.</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4, modified by Ray Chang.</div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span><span class="site-pv"><i class="fa fa-eye"></i> 本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css"><script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script></body></html>