<!DOCTYPE html><html class="theme-next pisces" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/logo.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=5.1.4"><link rel="mask-icon" href="/logo.png?v=5.1.4" color="#222"><meta name="keywords" content="Google SEO, 互联网营销"><link rel="alternate" href="/atom.xml" title="leadscloud" type="application/atom+xml"><meta name="description" content="Shell 简介Shell 语言对于接触 LINUX 的人来说都比较熟悉，它是系统的用户界面，提供了用户与内核进行交互操作的一种接口。它接收用户输入的命令并把它送入内核去执行。实际上 Shell 是一个命令解释器，它解释由用户输入的命令并且把它们送到内核。它没有一般编程语言的“编译 - 链接 - 运行”过程。不仅如此，Shell 有自己的编程语言用于对命令的编辑，它允许用户编写由 shell 命令"><meta property="og:type" content="article"><meta property="og:title" content="使用-shell-脚本对-linux-系统和进程资源进行监控"><meta property="og:url" content="https://leadscloud.github.io/313661/使用-shell-脚本对-linux-系统和进程资源进行监控/index.html"><meta property="og:site_name" content="leadscloud"><meta property="og:description" content="Shell 简介Shell 语言对于接触 LINUX 的人来说都比较熟悉，它是系统的用户界面，提供了用户与内核进行交互操作的一种接口。它接收用户输入的命令并把它送入内核去执行。实际上 Shell 是一个命令解释器，它解释由用户输入的命令并且把它们送到内核。它没有一般编程语言的“编译 - 链接 - 运行”过程。不仅如此，Shell 有自己的编程语言用于对命令的编辑，它允许用户编写由 shell 命令"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-09-26T05:41:25.719Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="使用-shell-脚本对-linux-系统和进程资源进行监控"><meta name="twitter:description" content="Shell 简介Shell 语言对于接触 LINUX 的人来说都比较熟悉，它是系统的用户界面，提供了用户与内核进行交互操作的一种接口。它接收用户输入的命令并把它送入内核去执行。实际上 Shell 是一个命令解释器，它解释由用户输入的命令并且把它们送到内核。它没有一般编程语言的“编译 - 链接 - 运行”过程。不仅如此，Shell 有自己的编程语言用于对命令的编辑，它允许用户编写由 shell 命令"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"ICJR9PAGXV",apiKey:"bc2584b59e34f42a84707067e8cef8a5",indexName:"love4026.org",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://leadscloud.github.io/313661/使用-shell-脚本对-linux-系统和进程资源进行监控/"><title>使用-shell-脚本对-linux-系统和进程资源进行监控 | leadscloud</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">leadscloud</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Google SEO|外贸营销推广</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-友情链接"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br> 友情链接</a></li><li class="menu-item menu-item-chrome扩展（域名所属人）"><a href="/serp-analyzer/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br> Chrome扩展（域名所属人）</a></li><li class="menu-item menu-item-外贸留言板系统"><a href="/20180615/google-seo-inquiry-messageboard/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br> 外贸留言板系统</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="algolia-popup popup search-popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://leadscloud.github.io/313661/使用-shell-脚本对-linux-系统和进程资源进行监控/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray"><meta itemprop="description" content="Think Difficulty"><meta itemprop="image" content="/logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="leadscloud"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">使用-shell-脚本对-linux-系统和进程资源进行监控</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2013-11-03T01:38:31+00:00">2013-11-03</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/转载/" itemprop="url" rel="index"><span itemprop="name">转载</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span><a href="/313661/使用-shell-脚本对-linux-系统和进程资源进行监控/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/313661/使用-shell-脚本对-linux-系统和进程资源进行监控/" itemprop="commentCount"></span></a></span> <span id="/313661/使用-shell-脚本对-linux-系统和进程资源进行监控/" class="leancloud_visitors" data-flag-title="使用-shell-脚本对-linux-系统和进程资源进行监控"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数&#58;</span><span class="leancloud-visitors-count"></span></span> <span class="post-meta-divider">|</span><span class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4,391</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="Shell-简介"><a href="#Shell-简介" class="headerlink" title="Shell 简介"></a>Shell 简介</h2><p>Shell 语言对于接触 LINUX 的人来说都比较熟悉，它是系统的用户界面，提供了用户与内核进行交互操作的一种接口。它接收用户输入的命令并把它送入内核去执行。实际上 Shell 是一个命令解释器，它解释由用户输入的命令并且把它们送到内核。它没有一般编程语言的“编译 - 链接 - 运行”过程。不仅如此，Shell 有自己的编程语言用于对命令的编辑，它允许用户编写由 shell 命令组成的程序。Shell 编程语言具有普通编程语言的很多特点，比如它也有循环结构和分支控制结构等，用这种编程语言编写的 Shell 程序与其他应用程序具有同样的效果。当然，Shell 功能也是很强大的。Shell 有多种类型，其中最常用的几种是 Bourne shell（sh）、C shell（csh）和 Korn shell（ksh）。三种 shell 各有优缺点，Linux 操作系统缺省的 shell 一般是 Bourne Again shell，它是 Bourne shell 的扩展，简称 Bash，bash 的命令语法是 Bourne shell 命令语法的超集，并且在 Bourne shell 的基础上增加、增强了很多特性。在这里，我们以 Bash 做为实例总结了使用 Shell 对系统和进程资源进行监控的一些内容，希望对您能有帮助。</p><p><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-shell-monitoring/#ibm-pcon" target="_blank" rel="noopener">回页首</a></p><h2 id="使用-Shell-对进程资源进行监控"><a href="#使用-Shell-对进程资源进行监控" class="headerlink" title="使用 Shell 对进程资源进行监控"></a>使用 Shell 对进程资源进行监控</h2><h3 id="检查进程是否存在"><a href="#检查进程是否存在" class="headerlink" title="检查进程是否存在"></a>检查进程是否存在</h3><p>在对进程进行监控时，我们一般需要得到该进程的 ID，进程 ID 是进程的唯一标识，但是有时可能在服务器上不同用户下运行着多个相同进程名的进程，下面的函数 GetPID 给出了获取指定用户下指定进程名的进程 ID 功能（目前只考虑这个用户下启动一个此进程名的进程），它有两个参数为用户名和进程名，它首先使用 ps 查找进程信息，同时通过 grep 过滤出需要的进程，最后通过 sed 和 awk 查找需要进程的 ID 值（此函数可根据实际情况修改，比如需要过滤其它信息等）。</p><h5 id="清单-1-对进程进行监控"><a href="#清单-1-对进程进行监控" class="headerlink" title="清单 1. 对进程进行监控"></a>清单 1. 对进程进行监控</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetPID</span> #<span class="title">User</span> #<span class="title">Name</span> </span></span><br><span class="line"> &#123; </span><br><span class="line">    PsUser=$<span class="number">1</span> </span><br><span class="line">    PsName=$<span class="number">2</span> </span><br><span class="line">    pid=`<span class="keyword">ps</span> -<span class="keyword">u</span> $PsUser|<span class="keyword">grep</span> $PsName|<span class="keyword">grep</span> -v <span class="keyword">grep</span>|<span class="keyword">grep</span> -v <span class="keyword">vi</span>|<span class="keyword">grep</span> -v dbx\n </span><br><span class="line">    |<span class="keyword">grep</span> -v tail|<span class="keyword">grep</span> -v start|<span class="keyword">grep</span> -v <span class="keyword">stop</span> |sed -n <span class="number">1</span><span class="keyword">p</span> |awk <span class="string">'&#123;print $1&#125;'</span>` </span><br><span class="line">    <span class="keyword">echo</span> $pid </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>示例演示：</p><p>1）源程序（例如查找用户为 root，进程名为 CFTestApp 的进程 ID）</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PID</span>=`GetPID root CFTestApp` </span><br><span class="line"></span><br><span class="line">echo <span class="variable">$PID</span></span><br></pre></td></tr></table></figure><p>2）结果输出</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11426</span> </span><br><span class="line">[dyu@xilinuxbldsrv <span class="keyword">shell</span><span class="bash">]$</span></span><br></pre></td></tr></table></figure><p>3）结果分析</p><p>从上面的输出可见：11426 为 root 用户下的 CFTestApp 程序的进程 ID。</p><p>4）命令介绍</p><p>1. ps: 查看系统中瞬间进程信息。 参数：<code>-u &lt;用户识别码&gt;</code> 列出属于该用户的程序的状况，也可使用用户名称来指定。 <code>-p &lt;进程识别码&gt;</code> 指定进程识别码，并列出该进程的状况。 -o 指定输出格式<br>2. grep: 用于查找文件中符合字符串的当前行。 参数：-v 反向选择，亦即显示出没有 ‘搜寻字符串’ 内容的那一行。<br>3. sed: 一个非交互性文本编辑器，它编辑文件或标准输入导出的文件，一次只能处理一行内容。 参数：-n 读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。 p 标志 打印匹配行<br>4. awk：一种编程语言，用于在 linux/unix 下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是 linux/unix 下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。awk 的处理文本和数据的方式：它逐行扫描文件，从第一行到最后一行，寻找匹配的特定模式的行，并在这些行上进行你想要的操作。如果没有指定处理动作，则把匹配的行显示到标准输出 ( 屏幕 )，如果没有指定模式，则所有被操作所指定的行都被处理。 参数：-F fs or –field-separator fs ：指定输入文件折分隔符，fs 是一个字符串或者是一个正则表达式，如 -F:。</p><p>有时有可能进程没有启动，下面的功能是检查进程 ID 是否存在，如果此进程没有运行输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The process does not exist. </span><br><span class="line"><span class="comment"># 检查进程是否存在</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"-<span class="variable">$PID</span>"</span> == <span class="string">"-"</span> ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"The process does not exist."</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="检测进程-CPU-利用率"><a href="#检测进程-CPU-利用率" class="headerlink" title="检测进程 CPU 利用率"></a>检测进程 CPU 利用率</h3><p>在对应用服务进行维护时，我们经常遇到由于 CPU 过高导致业务阻塞，造成业务中断的情况。CPU 过高可能由于业务量过负荷或者出现死循环等异常情况，通过脚本对业务进程 CPU 进行时时监控，可以在 CPU 利用率异常时及时通知维护人员，便于维护人员及时分析，定位，以及避免业务中断等。下面的函数可获得指定进程 ID 的进程 CPU 利用率。它有一个参数为进程 ID，它首先使用 ps 查找进程信息，同时通过 grep -v 过滤掉 %CPU 行，最后通过 awk 查找 CPU 利用百分比的整数部分（如果系统中有多个 CPU，CPU 利用率可以超过 100%）。</p><h5 id="清单-2-对业务进程-CPU-进行实时监控"><a href="#清单-2-对业务进程-CPU-进行实时监控" class="headerlink" title="清单 2. 对业务进程 CPU 进行实时监控"></a>清单 2. 对业务进程 CPU 进行实时监控</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> GetCpu </span><br><span class="line">  &#123; </span><br><span class="line">   CpuValue=`ps -p <span class="variable">$1</span> -o pcpu |grep -v CPU | awk <span class="string">'&#123;print $1&#125;'</span> | awk -  F. <span class="string">'&#123;print $1&#125;'</span>` </span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$CpuValue</span> </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>下面的功能是通过上面的函数 GetCpu 获得此进程的 CPU 利用率，然后通过条件语句判断 CPU 利用率是否超过限制，如果超过 80%（可以根据实际情况进行调整），则输出告警，否则输出正常信息。</p><h5 id="清单-3-判断-CPU-利用率是否超过限制"><a href="#清单-3-判断-CPU-利用率是否超过限制" class="headerlink" title="清单 3. 判断 CPU 利用率是否超过限制"></a>清单 3. 判断 CPU 利用率是否超过限制</h5><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> CheckCpu </span><br><span class="line"> &#123; </span><br><span class="line">    PID=<span class="variable">$1</span> </span><br><span class="line">    cpu=`GetCpu <span class="variable">$PID</span>` </span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$cpu</span> -<span class="literal">gt</span> <span class="number">80</span> ] </span><br><span class="line">    <span class="keyword">then</span> </span><br><span class="line">    &#123; </span><br><span class="line"> echo “The usage <span class="keyword">of</span> cpu <span class="literal">is</span> larger than <span class="number">80</span>%”</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123; </span><br><span class="line"> echo “The usage <span class="keyword">of</span> cpu <span class="literal">is</span> normal”</span><br><span class="line">    &#125; </span><br><span class="line">    fi </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>示例演示：</p><p>1）源程序（假设上面已经查询出 CFTestApp 的进程 ID 为 11426）</p><p><code>CheckCpu 11426</code></p><p>2）结果输出</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The usage <span class="keyword">of</span> cpu <span class="keyword">is</span> <span class="number">75</span> </span><br><span class="line">The usage <span class="keyword">of</span> cpu <span class="keyword">is</span> normal </span><br><span class="line">[dyu<span class="meta">@xilinuxbldsrv</span> shell]$</span><br></pre></td></tr></table></figure><p>3）结果分析</p><p>从上面的输出可见：CFTestApp 程序当前的 CPU 使用为 75%，是正常的，没有超过 80% 的告警限制。</p><h3 id="检测进程内存使用量"><a href="#检测进程内存使用量" class="headerlink" title="检测进程内存使用量"></a>检测进程内存使用量</h3><p>在对应用服务进行维护时，也经常遇到由于内存使用过大导致进程崩溃，造成业务中断的情况（例如 32 位程序可寻址的最大内存空间为 4G，如果超出将申请内存失败，同时物理内存也是有限的）。内存使用过高可能由于内存泄露，消息堆积等情况，通过脚本对业务进程内存使用量进行时时监控，可以在内存使用量异常时及时发送告警（例如通过短信），便于维护人员及时处理。下面的函数可获得指定进程 ID 的进程内存使用情况。它有一个参数为进程 ID，它首先使用 ps 查找进程信息，同时通过 grep -v 过滤掉 VSZ 行 , 然后通过除 1000 取以兆为单位的内存使用量。</p><h5 id="清单-4-对业务进程内存使用量进行监控"><a href="#清单-4-对业务进程内存使用量进行监控" class="headerlink" title="清单 4. 对业务进程内存使用量进行监控"></a>清单 4. 对业务进程内存使用量进行监控</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> GetMem </span><br><span class="line"> &#123; </span><br><span class="line">     MEMUsage=`ps -o vsz -p <span class="variable">$1</span>|grep -v VSZ` </span><br><span class="line">     (( MEMUsage /= 1000)) </span><br><span class="line">     <span class="built_in">echo</span> <span class="variable">$MEMUsage</span> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>下面的功能是通过上面的函数 <code>GetMem</code>获得此进程的内存使用，然后通过条件语句判断内存使用是否超过限制，如果超过 1.6G（可以根据实际情况进行调整），则输出告警，否则输出正常信息。</p><h5 id="清单-5-判断内存使用是否超过限制"><a href="#清单-5-判断内存使用是否超过限制" class="headerlink" title="清单 5. 判断内存使用是否超过限制"></a>清单 5. 判断内存使用是否超过限制</h5><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mem=`GetMem <span class="variable">$PID</span>`                </span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$mem</span> -<span class="literal">gt</span> <span class="number">1600</span> ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">    echo “The usage <span class="keyword">of</span> memory <span class="literal">is</span> larger than <span class="number">1.6</span>G”</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">   echo “The usage <span class="keyword">of</span> memory <span class="literal">is</span> normal”</span><br><span class="line">&#125; </span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>示例演示：</p><p>1）源程序（假设上面已经查询出 CFTestApp 的进程 ID 为 11426）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mem=`GetMem 11426` </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The usage of memory is <span class="variable">$mem</span> M"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$mem</span> -gt 1600 ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">     <span class="built_in">echo</span> <span class="string">"The usage of memory is larger than 1.6G"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"The usage of memory is normal"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>2）结果输出</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The usage <span class="keyword">of</span> memory <span class="keyword">is</span> <span class="number">248</span> M </span><br><span class="line">The usage <span class="keyword">of</span> memory <span class="keyword">is</span> normal </span><br><span class="line">[dyu<span class="meta">@xilinuxbldsrv</span> shell]$</span><br></pre></td></tr></table></figure><p>3）结果分析</p><p>从上面的输出可见：CFTestApp 程序当前的内存使用为 248M，是正常的，没有超过 1.6G 的告警限制。</p><h3 id="检测进程句柄使用量"><a href="#检测进程句柄使用量" class="headerlink" title="检测进程句柄使用量"></a>检测进程句柄使用量</h3><p>在对应用服务进行维护时，也经常遇到由于句柄使用 过量导致业务中断的情况。每个平台对进程的句柄使用都是有限的，例如在 Linux 平台，我们可以使用 ulimit – n 命令（open files (-n) 1024）或者对 /etc/security/limits.conf 的内容进行查看，得到进程句柄限制。句柄使用过高可能由于负载过高，句柄泄露等情况，通过脚本对业务进程句柄使用量进行时时监控，可以在异常时及时发送告警（例如通过短信），便于维护人员及时处理。下面的函数可获得指定进程 ID 的进程句柄使用情况。它有一个参数为进程 ID，它首先使用 ls 输出进程句柄信息，然后通过 wc -l 统计输出句柄个数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> GetDes </span><br><span class="line">&#123; </span><br><span class="line">    DES=`ls /proc/<span class="variable">$1</span>/fd | wc -l` </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$DES</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面功能是通过上面的函数 <code>GetDes</code>获得此进程的句柄使用量，然后通过条件语句判断句柄使用是否超过限制，如果超过 900（可以根据实际情况进行调整）个，则输出告警，否则输出正常信息。</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">des=` GetDes <span class="variable">$PID</span>` </span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$des</span> -<span class="literal">gt</span> <span class="number">900</span> ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">    echo “The<span class="built_in"> number</span> <span class="keyword">of</span> des <span class="literal">is</span> larger than <span class="number">900</span>”</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">   echo “The<span class="built_in"> number</span> <span class="keyword">of</span> des <span class="literal">is</span> normal”</span><br><span class="line">&#125; </span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>示例演示：</p><p>1）源程序（假设上面查询出 CFTestApp 的进程 ID 为 11426）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">des=`GetDes 11426` </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The number of des is <span class="variable">$des</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$des</span> -gt 900 ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">     <span class="built_in">echo</span> <span class="string">"The number of des is larger than 900"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"The number of des is normal"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>2）结果输出</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The <span class="built_in">number</span> <span class="keyword">of</span> des <span class="keyword">is</span> <span class="number">528</span> </span><br><span class="line">The <span class="built_in">number</span> <span class="keyword">of</span> des <span class="keyword">is</span> normal </span><br><span class="line">[dyu@xilinuxbldsrv shell]$</span><br></pre></td></tr></table></figure><p>3）结果分析</p><p>从上面的输出可见：CFTestApp 程序当前的句柄使用为 528 个，是正常的，没有超过 900 个的告警限制。</p><p>4）命令介绍</p><p>wc: 统计指定文件中的字节数、字数、行数 , 并将统计结果显示输出。</p><p>参数：-l 统计行数。 -c 统计字节数。 -w 统计字数。</p><p><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-shell-monitoring/#ibm-pcon" target="_blank" rel="noopener">回页首</a></p><h2 id="使用-Shell-对系统资源进行监控"><a href="#使用-Shell-对系统资源进行监控" class="headerlink" title="使用 Shell 对系统资源进行监控"></a>使用 Shell 对系统资源进行监控</h2><h3 id="查看某个-TCP-或-UDP-端口是否在监听"><a href="#查看某个-TCP-或-UDP-端口是否在监听" class="headerlink" title="查看某个 TCP 或 UDP 端口是否在监听"></a>查看某个 TCP 或 UDP 端口是否在监听</h3><p>端口检测是系统资源检测经常遇到的，特别是在网络通讯情况下，端口状态的检测往往是很重要的。有时可能进程，CPU，内存等处于正常状态，但是端口处于异常状态，业务也是没有正常运行。下面函数可判断指定端口是否在监听。它有一个参数为待检测端口，它首先使用 netstat 输出端口占用信息，然后通过 grep, awk,wc 过滤输出监听 TCP 端口的个数，第二条语句为输出 UDP 端口的监听个数，如果 TCP 与 UDP 端口监听都为 0，返回 0，否则返回 1.</p><h5 id="清单-6-端口检测"><a href="#清单-6-端口检测" class="headerlink" title="清单 6. 端口检测"></a>清单 6. 端口检测</h5><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function Listening </span><br><span class="line">&#123; </span><br><span class="line">   TCPListeningnum=`netstat -<span class="keyword">an</span> | grep <span class="string">":$1 "</span> | \<span class="keyword">n</span></span><br><span class="line">   awk '<span class="variable">$1</span> == <span class="string">"tcp"</span> &amp;&amp; <span class="variable">$NF</span> == <span class="string">"LISTEN"</span> &#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span>' | wc -<span class="keyword">l</span>` </span><br><span class="line">   UDPListeningnum=`netstat -<span class="keyword">an</span>|grep <span class="string">":$1 "</span> \<span class="keyword">n</span></span><br><span class="line">   |awk '<span class="variable">$1</span> == <span class="string">"udp"</span> &amp;&amp; <span class="variable">$NF</span> == <span class="string">"0.0.0.0:*"</span> &#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span>' | wc -<span class="keyword">l</span>` </span><br><span class="line">   (( Listeningnum = TCPListeningnum + UDPListeningnum )) </span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$Listeningnum</span> == 0 ] </span><br><span class="line">   then </span><br><span class="line">   &#123; </span><br><span class="line">       echo <span class="string">"0"</span></span><br><span class="line">   &#125; </span><br><span class="line">   <span class="keyword">else</span> </span><br><span class="line">   &#123; </span><br><span class="line">      echo <span class="string">"1"</span></span><br><span class="line">   &#125; </span><br><span class="line">   fi </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>示例演示：</p><p>1）源程序（例如查询 8080 端口的状态是否在监听）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">isListen=`Listening 8080` </span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$isListen</span> -eq 1 ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"The port is listening"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"The port is not listening"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>2）结果输出</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The<span class="built_in"> port </span>is listening </span><br><span class="line">[dyu@xilinuxbldsrv shell]$</span><br></pre></td></tr></table></figure><p>3）结果分析</p><p>从上面的输出可见：这个 Linux 服务器的 8080 端口处在监听状态。</p><p>4）命令介绍</p><p>netstat: 用于显示与 IP、TCP、UDP 和 ICMP 协议相关的统计数据，一般用于检验本机各端口的网络连接情况。 参数：-a 显示所有连线中的 Socket。 -n 直接使用 IP 地址，而不通过域名服务器。</p><p>下面的功能也是检测某个 TCP 或者 UDP 端口是否处在正常状态。</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp: netstat -<span class="keyword">an</span>|egrep <span class="variable">$1</span> |awk '<span class="variable">$6</span> == <span class="string">"LISTEN"</span> &amp;&amp; <span class="variable">$1</span> == <span class="string">"tcp"</span> &#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span>'</span><br><span class="line">udp: netstat -<span class="keyword">an</span>|egrep <span class="variable">$1</span> |awk '<span class="variable">$1</span> == <span class="string">"udp"</span> &amp;&amp; <span class="variable">$5</span> == <span class="string">"0.0.0.0:*"</span> &#123;<span class="keyword">print</span> <span class="variable">$0&#125;</span>'</span><br></pre></td></tr></table></figure><p>命令介绍</p><p>egrep: 在文件内查找指定的字符串。egrep 执行效果如 grep -E，使用的语法及参数可参照 grep 指令，与 grep 不同点在于解读字符串的方法，egrep 是用扩展的正则表达式语法来解读，而 grep 则用基本的正则表达式语法，扩展的正则表达式比基本的正则表达式有更完整的表达规范。</p><h3 id="查看某个进程名正在运行的个数"><a href="#查看某个进程名正在运行的个数" class="headerlink" title="查看某个进程名正在运行的个数"></a>查看某个进程名正在运行的个数</h3><p>有时我们可能需要得到服务器上某个进程的启动个数，下面的功能是检测某个进程正在运行的个数，例如进程名为 <code>CFTestApp。</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runnum=`<span class="keyword">ps</span> -ef | <span class="keyword">grep</span> -v <span class="keyword">vi</span> | <span class="keyword">grep</span> -v tail | <span class="keyword">grep</span> <span class="string">"[ /]CFTestApp"</span> | <span class="keyword">grep</span> -v <span class="keyword">grep</span> | wc -<span class="keyword">l</span></span><br></pre></td></tr></table></figure><h3 id="检测系统-CPU-负载"><a href="#检测系统-CPU-负载" class="headerlink" title="检测系统 CPU 负载"></a>检测系统 CPU 负载</h3><p>在对服务器进行维护时，有时也遇到由于系统 CPU（利用率）负载 过量导致业务中断的情况。服务器上可能运行多个进程，查看单个进程的 CPU 都是正常的，但是整个系统的 CPU 负载可能是异常的。通过脚本对系统 CPU 负载进行时时监控，可以在异常时及时发送告警，便于维护人员及时处理，预防事故发生。下面的函数可以检测系统 CPU 使用情况 . 使用 vmstat 取 5 次系统 CPU 的 idle 值，取平均值，然后通过与 100 取差得到当前 CPU 的实际占用值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> GetSysCPU </span><br><span class="line">&#123; </span><br><span class="line">  CpuIdle=`vmstat 1 5 |sed -n <span class="string">'3,$p'</span> \n</span><br><span class="line">  |awk <span class="string">'&#123;x = x + $15&#125; END &#123;print x/5&#125;'</span> |awk -F. <span class="string">'&#123;print $1&#125;'</span></span><br><span class="line">  CpuNum=`<span class="built_in">echo</span> <span class="string">"100-<span class="variable">$CpuIdle</span>"</span> | bc` </span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$CpuNum</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>示例演示：</p><p>1）源程序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cpu=`GetSysCPU` </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The system CPU is <span class="variable">$cpu</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$cpu</span> -gt 90 ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"The usage of system cpu is larger than 90%"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"The usage of system cpu is normal"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>2）结果输出</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The<span class="built_in"> system </span>CPU is 87 </span><br><span class="line">The usage of<span class="built_in"> system </span>cpu is normal </span><br><span class="line">[dyu@xilinuxbldsrv shell]$</span><br></pre></td></tr></table></figure><p>3）结果分析</p><p>从上面的输出可见：当前 Linux 服务器系统 CPU 利用率为 87%，是正常的，没有超过 90% 的告警限制。</p><p>4）命令介绍</p><p>vmstat：Virtual Meomory Statistics（虚拟内存统计）的缩写，可对操作系统的虚拟内存、进程、CPU 活动进行监视。<br>参数： -n 表示在周期性循环输出时，输出的头部信息仅显示一次。</p><h3 id="检测系统磁盘空间"><a href="#检测系统磁盘空间" class="headerlink" title="检测系统磁盘空间"></a>检测系统磁盘空间</h3><p>系统磁盘空间检测是系统资源检测的重要部分，在系统维护维护中，我们经常需要查看服务器磁盘空间使用情况。因为有些业务要时时写话单，日志，或者临时文件等，如果磁盘空间用尽，也可能会导致业务中断，下面的函数可以检测当前系统磁盘空间中某个目录的磁盘空间使用情况 . 输入参数为需要检测的目录名，使用 df 输出系统磁盘空间使用信息，然后通过 grep 和 awk 过滤得到某个目录的磁盘空间使用百分比。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> GetDiskSpc </span><br><span class="line">&#123; </span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$#</span> -ne 1 ] </span><br><span class="line">   <span class="keyword">then</span> </span><br><span class="line">       <span class="built_in">return</span> 1 </span><br><span class="line">   <span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line">   Folder=<span class="string">"<span class="variable">$1</span>$"</span></span><br><span class="line">   DiskSpace=`df -k |grep <span class="variable">$Folder</span> |awk <span class="string">'&#123;print $5&#125;'</span> |awk -F% <span class="string">'&#123;print $1&#125;'</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$DiskSpace</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>示例演示：</p><p>1）源程序（检测目录为 /boot）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Folder=<span class="string">"/boot"</span></span><br><span class="line"></span><br><span class="line">DiskSpace=`GetDiskSpc <span class="variable">$Folder</span>` </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The system <span class="variable">$Folder</span> disk space is <span class="variable">$DiskSpace</span>%"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$DiskSpace</span> -gt 90 ] </span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">&#123; </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"The usage of system disk(<span class="variable">$Folder</span>) is larger than 90%"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"The usage of system disk(<span class="variable">$Folder</span>)  is normal"</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>2）结果输出</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The<span class="built_in"> system </span>/boot disk space is 14% </span><br><span class="line">The usage of<span class="built_in"> system </span>disk(/boot)  is normal </span><br><span class="line">[dyu@xilinuxbldsrv shell]$</span><br></pre></td></tr></table></figure><p>3）结果分析</p><p>从上面的输出可见：当前此 Linux 服务器系统上 /boot 目录的磁盘空间已经使用了 14%，是正常的，没有超过使用 90% 的告警限制。</p><p>4）命令介绍</p><p>df：检查文件系统的磁盘空间占用情况。可以利用该命令来获取硬盘被占用了多少空间，目前还剩下多少空间等信息。 参数：-k 以 k 字节为单位显示。</p><p><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-shell-monitoring/#ibm-pcon" target="_blank" rel="noopener">回页首</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在 Linux 平台下，shell 脚本监控是一个非常简单，方便，有效的对服务器，进程进行监控的方法，对系统开发以及进程维护人员非常有帮助。它不仅可以对上面的信息进行监控，发送告警，同时也可以监控进程的日志等等的信息，希望本文对大家有帮助。</p><p><a href="http://www.love4026.org/wp-content/uploads/2013/11/test.zip" target="_blank" rel="noopener">源码下载</a></p></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/313658/quora精选：怎样克服拖延症？/" rel="next" title="quora精选：怎样克服拖延症？"><i class="fa fa-chevron-left"></i> quora精选：怎样克服拖延症？</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/313664/热力学第二定律错了吗？/" rel="prev" title="热力学第二定律错了吗？">热力学第二定律错了吗？<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/logo.png" alt="Ray"><p class="site-author-name" itemprop="name">Ray</p><p class="site-description motion-element" itemprop="description">Think Difficulty</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">441</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">11</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">253</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="aplayer-wrap motion-element"><div id="aplayer" class="aplayer"></div></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/leadscloud" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.v2ex.com/member/sbmzhcn" target="_blank" title="V2EX"><i class="fa fa-fw fa-globe"></i> V2EX</a></span><span class="links-of-author-item"><a href="mailto:love4026@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank"><img src="/images/cc-by-nc-nd.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://cdn.livechatinc.xyz/" title="RLiveChat" target="_blank">RLiveChat</a></li><li class="links-of-blogroll-item"> <a href="https://www.kamychina.com/" title="Roadheader" target="_blank">Roadheader</a></li><li class="links-of-blogroll-item"> <a href="https://tinycms.xyz/" title="TinyCMS" target="_blank">TinyCMS</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Shell-简介"><span class="nav-number">1.</span> <span class="nav-text">Shell 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Shell-对进程资源进行监控"><span class="nav-number">2.</span> <span class="nav-text">使用 Shell 对进程资源进行监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#检查进程是否存在"><span class="nav-number">2.1.</span> <span class="nav-text">检查进程是否存在</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#清单-1-对进程进行监控"><span class="nav-number">2.1.0.1.</span> <span class="nav-text">清单 1. 对进程进行监控</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检测进程-CPU-利用率"><span class="nav-number">2.2.</span> <span class="nav-text">检测进程 CPU 利用率</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#清单-2-对业务进程-CPU-进行实时监控"><span class="nav-number">2.2.0.1.</span> <span class="nav-text">清单 2. 对业务进程 CPU 进行实时监控</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#清单-3-判断-CPU-利用率是否超过限制"><span class="nav-number">2.2.0.2.</span> <span class="nav-text">清单 3. 判断 CPU 利用率是否超过限制</span></a></li></ol></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#检测进程内存使用量"><span class="nav-number">2.3.</span> <span class="nav-text">检测进程内存使用量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#清单-4-对业务进程内存使用量进行监控"><span class="nav-number">2.3.0.1.</span> <span class="nav-text">清单 4. 对业务进程内存使用量进行监控</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#清单-5-判断内存使用是否超过限制"><span class="nav-number">2.3.0.2.</span> <span class="nav-text">清单 5. 判断内存使用是否超过限制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检测进程句柄使用量"><span class="nav-number">2.4.</span> <span class="nav-text">检测进程句柄使用量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Shell-对系统资源进行监控"><span class="nav-number">3.</span> <span class="nav-text">使用 Shell 对系统资源进行监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看某个-TCP-或-UDP-端口是否在监听"><span class="nav-number">3.1.</span> <span class="nav-text">查看某个 TCP 或 UDP 端口是否在监听</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#清单-6-端口检测"><span class="nav-number">3.1.0.1.</span> <span class="nav-text">清单 6. 端口检测</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看某个进程名正在运行的个数"><span class="nav-number">3.2.</span> <span class="nav-text">查看某个进程名正在运行的个数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检测系统-CPU-负载"><span class="nav-number">3.3.</span> <span class="nav-text">检测系统 CPU 负载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检测系统磁盘空间"><span class="nav-number">3.4.</span> <span class="nav-text">检测系统磁盘空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">Copyright &copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="heart"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">leadscloud. All rights reserved.</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4, modified by Ray.</div><div class="leancloud-count"><span id="/" class="leancloud_site_visitors" data-flag-title="leadscloud"><i class="fa fa-eye"></i> 本站总访问量<span class="leancloud-visitors-count"></span> 次</span></div><script>var _mtac={};!function(){var t=document.createElement("script");t.src="https://pingjs.qq.com/h5/stats.js?v2.0.4",t.setAttribute("name","MTAH5"),t.setAttribute("sid","500595572");var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script id="ribbon" type="text/javascript" size="200" alpha="0.6" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'ePPAQV9hFzcbhOaQvvtyjTnw-gzGzoHsz',
        appKey: 'GLniGVXsSMGBjTmaiI4wleaF',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script><link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css"><script src="/lib/algolia-instant-search/instantsearch.min.js"></script><script src="/js/src/algolia-search.js?v=5.1.4"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("ePPAQV9hFzcbhOaQvvtyjTnw-gzGzoHsz","GLniGVXsSMGBjTmaiI4wleaF")</script><script>function showTime(e){var t=new AV.Query(e),c=[],u=$(".leancloud_visitors");u.each(function(){c.push($(this).attr("id").trim())}),t.containedIn("url",c),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var n=0;n<e.length;n++){var o=e[n],i=o.get("url"),s=o.get("time"),l=document.getElementById(i);$(l).find(t).text(s)}for(n=0;n<c.length;n++){i=c[n],l=document.getElementById(i);var r=$(l).find(t);""==r.text()&&r.text(0)}}else u.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(i,e){var t=$(e),s=t.attr("id").trim(),l=t.attr("data-flag-title").trim(),n=new AV.Query(i);n.equalTo("url",s),n.find({success:function(e){if(0<e.length){var t=e[0];t.fetchWhenSave(!0),t.increment("time"),t.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var n=new i,o=new AV.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!0),n.setACL(o),n.set("title",l),n.set("url",s),n.set("time",1),n.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_site_visitors").length&&addCount(e,".leancloud_site_visitors"),1==$(".leancloud_visitors").length?addCount(e,".leancloud_visitors"):1<$(".post-title-link").length&&showTime(e)})</script><script src="/js/src/APlayer.min.js?v=5.1.4"></script><script type="text/javascript">var playlist=[];playlist.push({title:"小城故事",author:"纯音乐",url:"http://blog-music.test.upcdn.net/xiaochenggushi.mp3",pic:"",lrc:""}),playlist.push({title:"Should it matter",author:"Sissel Kyrkjeb",url:"http://blog-music.test.upcdn.net/should-it-matter.mp3",pic:"",lrc:""}),playlist.push({title:"爱在西元前",author:"周杰伦",url:"http://blog-music.test.upcdn.net/aizaixiyuanqian.mp3",pic:"",lrc:""});var ap=new APlayer({element:document.getElementById("aplayer"),autoplay:!1,mode:"random",preload:"none",music:playlist})</script></body></html>